<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ | Quick Hand Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-card-hover: #22222e;
            --accent-gold: #ffd700;
            --accent-green: #00d4aa;
            --accent-red: #ff4757;
            --accent-blue: #4a9eff;
            --accent-purple: #a855f7;
            --accent-orange: #ff9500;
            --text-primary: #f5f5f7;
            --text-secondary: #a0a0a8;
            --text-muted: #6a6a72;
            --border-color: #2a2a36;
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            --shadow-glow: 0 0 40px rgba(255, 215, 0, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-decoration {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }

        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 48px; margin-bottom: 10px; }
        .title {
            font-size: 32px; font-weight: 700;
            background: var(--gradient-gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 8px; }

        .main-panel {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 12px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--gradient-gold);
            color: #000;
            font-weight: 600;
        }

        .step.completed {
            background: rgba(0, 212, 170, 0.2);
            color: var(--accent-green);
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            background: var(--bg-card);
        }

        .step.active .step-number { background: rgba(0,0,0,0.2); }
        .step.completed .step-number { background: var(--accent-green); color: white; }

        .step-arrow { color: var(--text-muted); margin: 0 5px; }

        /* AI é€‰æ‹©å™¨ */
        .ai-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .ai-option {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .ai-option:hover { border-color: var(--accent-gold); }
        .ai-option.active.gemini { border-color: var(--accent-blue); background: rgba(74, 158, 255, 0.1); }
        .ai-option.active.deepseek { border-color: var(--accent-purple); background: rgba(168, 85, 247, 0.1); }

        .ai-option .ai-icon { font-size: 32px; margin-bottom: 10px; }
        .ai-option .ai-name { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .ai-option .ai-desc { font-size: 12px; color: var(--text-muted); }
        .ai-option.gemini .ai-name { color: var(--accent-blue); }
        .ai-option.deepseek .ai-name { color: var(--accent-purple); }

        .ai-badge {
            display: inline-block;
            padding: 2px 8px;
            font-size: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .ai-option.gemini .ai-badge { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .ai-option.deepseek .ai-badge { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        /* è­¦å‘Šæç¤º */
        .warning-banner {
            display: none;
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid var(--accent-orange);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--accent-orange);
            align-items: center;
            gap: 12px;
        }

        .warning-banner.visible { display: flex; }
        .warning-banner .warning-icon { font-size: 24px; }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .upload-section, .ai-selector { 
                grid-template-columns: 1fr; 
                flex-direction: column;
            }
        }

        .upload-card {
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-card:hover { border-color: var(--accent-gold); }
        .upload-card.has-image { border-style: solid; border-color: var(--accent-green); }
        .upload-card.processing { border-color: var(--accent-blue); }
        .upload-card input[type="file"] { display: none; }

        .upload-icon { font-size: 40px; margin-bottom: 12px; }
        .upload-title { font-size: 16px; font-weight: 500; margin-bottom: 6px; }
        .upload-desc { font-size: 12px; color: var(--text-muted); }

        .upload-preview {
            max-width: 100%;
            max-height: 180px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }

        .upload-card.has-image .upload-preview { display: block; }
        .upload-card.has-image .upload-placeholder { display: none; }

        .clear-btn {
            display: none;
            position: absolute;
            top: 10px; right: 10px;
            padding: 6px 12px;
            font-size: 11px;
            color: white;
            background: var(--accent-red);
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .upload-card.has-image .clear-btn { display: block; }

        /* OCRå¤„ç†çŠ¶æ€ */
        .ocr-status {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 14px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .upload-card.processing .ocr-status { display: flex; }

        .ocr-spinner {
            width: 40px; height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .ocr-text { font-size: 13px; color: var(--accent-blue); }

        /* ä¿¡æ¯ç¡®è®¤åŒºåŸŸ */
        .confirm-section {
            display: none;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-gold);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .confirm-section.visible { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .confirm-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confirm-tip {
            font-size: 12px;
            color: var(--text-muted);
            background: var(--bg-card);
            padding: 6px 12px;
            border-radius: 6px;
        }

        .confirm-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .confirm-grid { grid-template-columns: 1fr; }
        }

        .confirm-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
        }

        .confirm-card-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--accent-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confirm-form { display: flex; flex-direction: column; gap: 12px; }

        .confirm-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .confirm-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .confirm-field.full { grid-column: 1 / -1; }

        .confirm-field label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .confirm-input {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
        }

        .confirm-input:focus { outline: none; border-color: var(--accent-gold); }

        .confirm-input.textarea {
            min-height: 60px;
            resize: vertical;
            font-size: 11px;
        }

        .confirm-input.highlight {
            border-color: var(--accent-green);
            background: rgba(0, 212, 170, 0.05);
        }

        /* è®¾ç½®åŒºåŸŸ */
        .settings-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--accent-gold);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .setting-item { display: flex; flex-direction: column; gap: 6px; }
        .setting-label { font-size: 12px; color: var(--text-secondary); }

        .setting-input {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
        }

        .setting-input:focus { outline: none; border-color: var(--accent-gold); }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary {
            background: var(--gradient-gold);
            color: #000;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) { border-color: var(--accent-gold); }

        .btn .spinner {
            display: none;
            width: 18px; height: 18px;
            border: 2px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn.loading .spinner { display: block; }
        .btn.loading .btn-text { display: none; }

        /* ç»“æœåŒºåŸŸ */
        .result-section { margin-top: 30px; display: none; }
        .result-section.visible { display: block; animation: fadeIn 0.4s ease; }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .result-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-ai-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .result-ai-badge.gemini { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .result-ai-badge.deepseek { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        .copy-btn {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }

        .result-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .result-text {
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-primary);
            word-wrap: break-word;
        }

        .result-text h1, .result-text h2, .result-text h3 { color: var(--accent-gold); margin: 18px 0 10px 0; }
        .result-text h1 { font-size: 22px; }
        .result-text h2 { font-size: 18px; }
        .result-text h3 { font-size: 15px; }
        .result-text strong { color: var(--accent-green); }
        .result-text em { color: var(--text-secondary); font-style: italic; }
        .result-text code { background: var(--bg-card); padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; color: var(--accent-blue); font-size: 12px; }
        .result-text pre { background: var(--bg-card); padding: 15px; border-radius: 8px; overflow-x: auto; margin: 12px 0; border: 1px solid var(--border-color); }
        .result-text pre code { background: transparent; padding: 0; color: var(--text-secondary); }
        .result-text ul, .result-text ol { margin: 10px 0; padding-left: 20px; }
        .result-text li { margin: 6px 0; }
        .result-text hr { border: none; border-top: 1px solid var(--border-color); margin: 15px 0; }

        /* æ€è€ƒè¿‡ç¨‹ */
        .thinking-section { margin-bottom: 20px; background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 12px; overflow: hidden; }
        .thinking-header { padding: 12px 20px; background: rgba(168, 85, 247, 0.1); cursor: pointer; display: flex; align-items: center; justify-content: space-between; font-size: 14px; color: var(--accent-purple); }
        .thinking-header:hover { background: rgba(168, 85, 247, 0.15); }
        .thinking-content { padding: 20px; display: none; font-size: 13px; color: var(--text-secondary); line-height: 1.7; max-height: 400px; overflow-y: auto; white-space: pre-wrap; }
        .thinking-content.visible { display: block; }

        /* æ—¥å¿— */
        .log-section { margin-top: 25px; background: var(--bg-secondary); border-radius: 10px; padding: 15px; max-height: 150px; overflow-y: auto; }
        .log-title { font-size: 12px; color: var(--text-muted); margin-bottom: 10px; }
        .log-content { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .log-item { padding: 3px 0; border-bottom: 1px solid var(--border-color); }
        .log-item:last-child { border-bottom: none; }
        .log-time { color: var(--text-muted); margin-right: 8px; }
        .log-success { color: var(--accent-green); }
        .log-error { color: var(--accent-red); }
        .log-info { color: var(--accent-blue); }
        .log-warning { color: var(--accent-orange); }

        /* Toast */
        .toast { position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 10px; font-size: 13px; z-index: 1000; display: none; max-width: 350px; }
        .toast.visible { display: block; animation: slideIn 0.3s ease; }
        .toast.error { background: var(--accent-red); color: white; }
        .toast.success { background: var(--accent-green); color: white; }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .footer { text-align: center; margin-top: 40px; padding: 20px; color: var(--text-muted); font-size: 12px; }
        .footer a { color: var(--accent-gold); text-decoration: none; }

        /* éšè—åŒºåŸŸ */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="toast error" id="errorToast"></div>
    <div class="toast success" id="successToast"></div>

    <div class="container">
        <header class="header">
            <div class="logo">ğŸƒ</div>
            <h1 class="title">å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜</h1>
            <p class="subtitle">OCRæ™ºèƒ½è¯†åˆ« Â· äººå·¥ç¡®è®¤ Â· AIæ·±åº¦åˆ†æ</p>
        </header>

        <main class="main-panel">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="steps-indicator">
                <div class="step active" id="step1">
                    <span class="step-number">1</span>
                    <span>ä¸Šä¼ æˆªå›¾</span>
                </div>
                <span class="step-arrow">â†’</span>
                <div class="step" id="step2">
                    <span class="step-number">2</span>
                    <span>ç¡®è®¤ä¿¡æ¯</span>
                </div>
                <span class="step-arrow">â†’</span>
                <div class="step" id="step3">
                    <span class="step-number">3</span>
                    <span>AIåˆ†æ</span>
                </div>
            </div>

            <!-- AI é€‰æ‹©å™¨ -->
            <div class="ai-selector">
                <div class="ai-option gemini active" onclick="selectAI('gemini')">
                    <div class="ai-icon">ğŸŒ</div>
                    <div class="ai-name">Google Gemini</div>
                    <div class="ai-desc">å¤šæ¨¡æ€AIï¼Œæ”¯æŒæˆªå›¾è¯†åˆ«</div>
                    <div class="ai-badge">éœ€è¦VPN</div>
                </div>
                <div class="ai-option deepseek" onclick="selectAI('deepseek')">
                    <div class="ai-icon">ğŸ§ </div>
                    <div class="ai-name">DeepSeek R1</div>
                    <div class="ai-desc">æ·±åº¦æ€è€ƒæ¨¡å¼ï¼ˆéœ€æ‰‹åŠ¨è¾“å…¥ï¼‰</div>
                    <div class="ai-badge">å›½å†…å¯ç”¨</div>
                </div>
            </div>

            <!-- DeepSeekè­¦å‘Š -->
            <div class="warning-banner" id="deepseekWarning">
                <span class="warning-icon">ğŸ§ </span>
                <span><strong>DeepSeekæ¨¡å¼ï¼š</strong>è¯·åœ¨"ç¡®è®¤ä¿¡æ¯"åŒºåŸŸæ‰‹åŠ¨å¡«å†™æ•°æ®ï¼Œä¸æ”¯æŒæˆªå›¾è¯†åˆ«ã€‚</span>
            </div>

            <!-- æ­¥éª¤1ï¼šä¸Šä¼ æˆªå›¾ -->
            <div id="uploadSection">
                <div class="upload-section">
                    <!-- æ‰‹ç‰Œæˆªå›¾ -->
                    <div class="upload-card" id="handCard" onclick="triggerUpload('hand', event)">
                        <input type="file" id="handInput" accept="image/*" onchange="handleImageUpload(this, 'hand')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ´</div>
                            <div class="upload-title">ä¸Šä¼ æ‰‹ç‰Œæˆªå›¾</div>
                            <div class="upload-desc">ç‰Œå±€å›é¡¾ç•Œé¢</div>
                        </div>
                        <img class="upload-preview" id="handPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('hand'); event.stopPropagation();">âœ•</button>
                        <div class="ocr-status">
                            <div class="ocr-spinner"></div>
                            <div class="ocr-text">AIè¯†åˆ«ä¸­...</div>
                        </div>
                    </div>

                    <!-- å¯¹æ‰‹æˆªå›¾ -->
                    <div class="upload-card" id="opponentCard" onclick="triggerUpload('opponent', event)">
                        <input type="file" id="opponentInput" accept="image/*" onchange="handleImageUpload(this, 'opponent')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ‘¤</div>
                            <div class="upload-title">ä¸Šä¼ å¯¹æ‰‹æ•°æ®</div>
                            <div class="upload-desc">å¯¹æ‰‹é¢æ¿æˆªå›¾</div>
                        </div>
                        <img class="upload-preview" id="opponentPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('opponent'); event.stopPropagation();">âœ•</button>
                        <div class="ocr-status">
                            <div class="ocr-spinner"></div>
                            <div class="ocr-text">AIè¯†åˆ«ä¸­...</div>
                        </div>
                    </div>
                </div>

                <!-- è¯†åˆ«æŒ‰é’® -->
                <div class="btn-group">
                    <button class="btn btn-primary" id="ocrBtn" onclick="startOCR()" disabled>
                        <span class="spinner"></span>
                        <span class="btn-text">ğŸ” å¼€å§‹è¯†åˆ«æˆªå›¾</span>
                    </button>
                </div>
            </div>

            <!-- æ­¥éª¤2ï¼šç¡®è®¤ä¿¡æ¯ -->
            <div class="confirm-section" id="confirmSection">
                <div class="confirm-header">
                    <div class="confirm-title">
                        <span>âœï¸</span>
                        <span>ç¡®è®¤/ä¿®æ­£è¯†åˆ«ä¿¡æ¯</span>
                    </div>
                    <div class="confirm-tip">ğŸ’¡ å¦‚æœ‰è¯†åˆ«é”™è¯¯è¯·ä¿®æ­£åå†åˆ†æ</div>
                </div>

                <div class="confirm-grid">
                    <!-- æ‰‹ç‰Œä¿¡æ¯ -->
                    <div class="confirm-card">
                        <div class="confirm-card-title">
                            <span>ğŸ´</span>
                            <span>æ‰‹ç‰Œä¿¡æ¯</span>
                        </div>
                        <div class="confirm-form">
                            <div class="confirm-row">
                                <div class="confirm-field">
                                    <label>ç›²æ³¨ç»“æ„</label>
                                    <input type="text" class="confirm-input" id="cfmBlinds" placeholder="å¦‚: 2/4/8">
                                </div>
                                <div class="confirm-field">
                                    <label>åº•æ± å¤§å°</label>
                                    <input type="text" class="confirm-input" id="cfmPot" placeholder="å¦‚: 959.3">
                                </div>
                            </div>
                            <div class="confirm-row">
                                <div class="confirm-field">
                                    <label>æˆ‘çš„æ‰‹ç‰Œ â­</label>
                                    <input type="text" class="confirm-input highlight" id="cfmMyHand" placeholder="å¦‚: KsAd">
                                </div>
                                <div class="confirm-field">
                                    <label>æˆ‘çš„ä½ç½®</label>
                                    <input type="text" class="confirm-input" id="cfmPosition" placeholder="å¦‚: CO/BTN">
                                </div>
                            </div>
                            <div class="confirm-field full">
                                <label>å…¬å…±ç‰Œ â­</label>
                                <input type="text" class="confirm-input highlight" id="cfmBoard" placeholder="å¦‚: Jc Qc 7c 5s 5h">
                            </div>
                            <div class="confirm-field full">
                                <label>å¯¹æ‰‹æ‰‹ç‰Œ</label>
                                <input type="text" class="confirm-input" id="cfmVillainHand" placeholder="å¦‚: JdJh">
                            </div>
                            <div class="confirm-field full">
                                <label>è¡ŒåŠ¨è®°å½•</label>
                                <textarea class="confirm-input textarea" id="cfmAction" placeholder="ç¿»å‰/ç¿»ç‰Œ/è½¬ç‰Œ/æ²³ç‰Œçš„è¡ŒåŠ¨..."></textarea>
                            </div>
                            <div class="confirm-field full">
                                <label>ç»“æœ</label>
                                <input type="text" class="confirm-input" id="cfmResult" placeholder="å¦‚: è¾“438.5">
                            </div>
                        </div>
                    </div>

                    <!-- å¯¹æ‰‹æ•°æ® -->
                    <div class="confirm-card">
                        <div class="confirm-card-title">
                            <span>ğŸ‘¤</span>
                            <span>å¯¹æ‰‹æ•°æ®</span>
                        </div>
                        <div class="confirm-form">
                            <div class="confirm-row">
                                <div class="confirm-field">
                                    <label>å¯¹æ‰‹æ˜µç§°</label>
                                    <input type="text" class="confirm-input" id="cfmVillainName" placeholder="å¦‚: xiaolv">
                                </div>
                                <div class="confirm-field">
                                    <label>æ‰‹æ•°</label>
                                    <input type="text" class="confirm-input" id="cfmVillainHands" placeholder="å¦‚: 8446">
                                </div>
                            </div>
                            <div class="confirm-row">
                                <div class="confirm-field">
                                    <label>å…¥å±€ç‡ VPIP â­</label>
                                    <input type="text" class="confirm-input highlight" id="cfmVillainVPIP" placeholder="å¦‚: 45%">
                                </div>
                                <div class="confirm-field">
                                    <label>èƒœç‡</label>
                                    <input type="text" class="confirm-input" id="cfmVillainWinRate" placeholder="å¦‚: 20%">
                                </div>
                            </div>
                            <div class="confirm-row">
                                <div class="confirm-field">
                                    <label>æ‘Šç‰Œç‡</label>
                                    <input type="text" class="confirm-input" id="cfmVillainShowdown" placeholder="å¦‚: 13%">
                                </div>
                                <div class="confirm-field">
                                    <label>å¤‡æ³¨</label>
                                    <input type="text" class="confirm-input" id="cfmVillainNotes" placeholder="é£æ ¼å¤‡æ³¨">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½® -->
            <div class="settings-section">
                <div class="settings-title">âš™ï¸ åˆ†æè®¾ç½®</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">ä½ çš„æ˜µç§°</label>
                        <input type="text" class="setting-input" id="username" value="Luckywm">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">ç­¹ç æ·±åº¦ (BB)</label>
                        <input type="text" class="setting-input" id="stackDepth" value="200-300">
                    </div>
                </div>
            </div>

            <!-- åˆ†ææŒ‰é’® -->
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="resetAll()">
                    <span class="btn-text">ğŸ”„ é‡æ–°å¼€å§‹</span>
                </button>
                <button class="btn btn-primary" id="analyzeBtn" onclick="analyzeHand()">
                    <span class="spinner"></span>
                    <span class="btn-text">ğŸš€ å¼€å§‹AIæ·±åº¦åˆ†æ</span>
                </button>
            </div>

            <!-- ç»“æœåŒºåŸŸ -->
            <section class="result-section" id="resultSection">
                <div class="result-header">
                    <h2 class="result-title">
                        <span>ğŸ“Š</span>
                        <span>åˆ†æç»“æœ</span>
                        <span class="result-ai-badge" id="resultAiBadge"></span>
                    </h2>
                    <button class="copy-btn" onclick="copyResult()">ğŸ“‹ å¤åˆ¶</button>
                </div>
                
                <div class="thinking-section" id="thinkingSection" style="display: none;">
                    <div class="thinking-header" onclick="toggleThinking()">
                        <span>ğŸ§  DeepSeek æ€è€ƒè¿‡ç¨‹</span>
                        <span id="thinkingToggle">â–¼ å±•å¼€</span>
                    </div>
                    <div class="thinking-content" id="thinkingContent"></div>
                </div>
                
                <div class="result-content">
                    <div class="result-text" id="resultText"></div>
                </div>
            </section>

            <!-- æ—¥å¿— -->
            <div class="log-section">
                <div class="log-title">ğŸ“ è¿è¡Œæ—¥å¿—</div>
                <div class="log-content" id="logContent">
                    <div class="log-item">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span class="log-info">å·¥å…·å·²å°±ç»ª</span>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>OCRè¯†åˆ« + AIæ·±åº¦åˆ†æ Â· <a href="index.html">è¿”å›ä¸»é¡µ</a></p>
        </footer>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const CONFIG = {
            GEMINI_API_KEY: 'AIzaSyCGLHoZLcXU7oQiKXT9929PZwal1UenRjY',
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
            DEEPSEEK_API_KEY: 'sk-e4f2758c58d14807bc9004539ffbb0e8',
            DEEPSEEK_API_URL: 'https://api.deepseek.com/chat/completions',
            REQUEST_TIMEOUT: 120000
        };

        // çŠ¶æ€
        let selectedAI = 'gemini';
        let uploadedImages = { hand: null, opponent: null };
        let ocrCompleted = false;
        let currentStep = 1;

        // ==================== æ­¥éª¤ç®¡ç† ====================
        function setStep(step) {
            currentStep = step;
            ['step1', 'step2', 'step3'].forEach((id, idx) => {
                const el = document.getElementById(id);
                el.classList.remove('active', 'completed');
                if (idx + 1 < step) el.classList.add('completed');
                else if (idx + 1 === step) el.classList.add('active');
            });
        }

        // ==================== AI é€‰æ‹© ====================
        function selectAI(ai) {
            selectedAI = ai;
            document.querySelectorAll('.ai-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`.ai-option.${ai}`).classList.add('active');
            
            const warning = document.getElementById('deepseekWarning');
            warning.classList.toggle('visible', ai === 'deepseek');
            
            // DeepSeekç›´æ¥æ˜¾ç¤ºç¡®è®¤åŒºåŸŸï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰
            if (ai === 'deepseek') {
                document.getElementById('confirmSection').classList.add('visible');
                setStep(2);
            }
            
            addLog(`ğŸ¤– åˆ‡æ¢åˆ° ${ai === 'gemini' ? 'Gemini' : 'DeepSeek R1'}`, 'info');
        }

        // ==================== å›¾ç‰‡å¤„ç† ====================
        function triggerUpload(type, event) {
            if (event.target.classList.contains('clear-btn')) return;
            document.getElementById(`${type}Input`).click();
        }

        function handleImageUpload(input, type) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                showError('å›¾ç‰‡å¤ªå¤§ï¼Œæœ€å¤§10MB');
                return;
            }

            // DeepSeekä¸æ”¯æŒå›¾ç‰‡ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°Gemini
            if (selectedAI === 'deepseek') {
                selectAI('gemini');
                showError('æˆªå›¾è¯†åˆ«éœ€è¦Geminiï¼Œå·²è‡ªåŠ¨åˆ‡æ¢');
            }

            addLog(`ğŸ“· ä¸Šä¼ ${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}æˆªå›¾...`, 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                compressImage(e.target.result, function(data) {
                    uploadedImages[type] = data;
                    document.getElementById(`${type}Preview`).src = data;
                    document.getElementById(`${type}Card`).classList.add('has-image');
                    addLog(`âœ… ${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}æˆªå›¾å·²ä¸Šä¼ `, 'success');
                    updateOCRButton();
                });
            };
            reader.readAsDataURL(file);
        }

        function compressImage(dataUrl, callback) {
            const img = new Image();
            img.onload = function() {
                const maxDim = 1600;
                let w = img.width, h = img.height;
                if (w > maxDim || h > maxDim) {
                    const ratio = Math.min(maxDim / w, maxDim / h);
                    w = Math.round(w * ratio);
                    h = Math.round(h * ratio);
                    const canvas = document.createElement('canvas');
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.9));
                } else {
                    callback(dataUrl);
                }
            };
            img.src = dataUrl;
        }

        function clearImage(type) {
            uploadedImages[type] = null;
            document.getElementById(`${type}Preview`).src = '';
            document.getElementById(`${type}Card`).classList.remove('has-image');
            document.getElementById(`${type}Input`).value = '';
            updateOCRButton();
        }

        function updateOCRButton() {
            const btn = document.getElementById('ocrBtn');
            btn.disabled = !uploadedImages.hand && !uploadedImages.opponent;
        }

        // ==================== OCR è¯†åˆ« ====================
        async function startOCR() {
            if (!uploadedImages.hand && !uploadedImages.opponent) {
                showError('è¯·è‡³å°‘ä¸Šä¼ ä¸€å¼ æˆªå›¾');
                return;
            }

            const btn = document.getElementById('ocrBtn');
            btn.disabled = true;
            btn.classList.add('loading');

            addLog('ğŸ” å¼€å§‹OCRè¯†åˆ«...', 'info');

            try {
                // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
                if (uploadedImages.hand) document.getElementById('handCard').classList.add('processing');
                if (uploadedImages.opponent) document.getElementById('opponentCard').classList.add('processing');

                // è°ƒç”¨Geminiè¿›è¡ŒOCR
                const ocrResult = await performOCR();
                
                // å¡«å……è¯†åˆ«ç»“æœ
                fillOCRResults(ocrResult);
                
                // æ˜¾ç¤ºç¡®è®¤åŒºåŸŸ
                document.getElementById('confirmSection').classList.add('visible');
                ocrCompleted = true;
                setStep(2);
                
                addLog('âœ… OCRè¯†åˆ«å®Œæˆï¼Œè¯·ç¡®è®¤ä¿¡æ¯', 'success');
                showSuccess('è¯†åˆ«å®Œæˆï¼è¯·æ£€æŸ¥å¹¶ç¡®è®¤ä¿¡æ¯');

            } catch (error) {
                console.error('OCR Error:', error);
                addLog(`âŒ OCRå¤±è´¥: ${error.message}`, 'error');
                showError(error.message);
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
                document.getElementById('handCard').classList.remove('processing');
                document.getElementById('opponentCard').classList.remove('processing');
            }
        }

        async function performOCR() {
            const parts = [{
                text: `è¯·ä»”ç»†è¯†åˆ«è¿™äº›å¾·å·æ‰‘å…‹æˆªå›¾ä¸­çš„ä¿¡æ¯ï¼Œå¹¶ä»¥JSONæ ¼å¼è¿”å›ã€‚

éœ€è¦è¯†åˆ«çš„ä¿¡æ¯ï¼š
1. ç›²æ³¨ç»“æ„ï¼ˆå¦‚2/4/8ï¼‰
2. åº•æ± å¤§å°
3. ç©å®¶"Luckywm"çš„æ‰‹ç‰Œï¼ˆå¦‚KsAdè¡¨ç¤ºé»‘æ¡ƒKæ–¹å—Aï¼‰
4. ç©å®¶"Luckywm"çš„ä½ç½®
5. å…¬å…±ç‰Œï¼ˆ5å¼ ï¼Œå¦‚Jc Qc 7c 5s 5hï¼‰
6. ä¸»è¦å¯¹æ‰‹çš„æ‰‹ç‰Œ
7. è¡ŒåŠ¨è®°å½•
8. æœ€ç»ˆç»“æœ/ç›ˆäº
9. å¯¹æ‰‹æ˜µç§°
10. å¯¹æ‰‹ç»Ÿè®¡æ•°æ®ï¼ˆæ‰‹æ•°ã€å…¥å±€ç‡ã€èƒœç‡ã€æ‘Šç‰Œç‡ï¼‰

ç‰Œé¢æ ¼å¼è¯´æ˜ï¼š
- s=é»‘æ¡ƒâ™ , h=çº¢æ¡ƒâ™¥, d=æ–¹å—â™¦, c=æ¢…èŠ±â™£
- å¦‚ï¼šAh=çº¢æ¡ƒA, Ks=é»‘æ¡ƒK, Qd=æ–¹å—Q, Jc=æ¢…èŠ±J

è¯·è¿”å›JSONæ ¼å¼ï¼ˆå¦‚æœæŸé¡¹æ— æ³•è¯†åˆ«å°±ç•™ç©ºï¼‰ï¼š
{
    "blinds": "ç›²æ³¨ç»“æ„",
    "pot": "åº•æ± ",
    "myHand": "æˆ‘çš„æ‰‹ç‰Œ",
    "position": "æˆ‘çš„ä½ç½®",
    "board": "å…¬å…±ç‰Œ",
    "villainHand": "å¯¹æ‰‹æ‰‹ç‰Œ",
    "action": "è¡ŒåŠ¨è®°å½•",
    "result": "ç»“æœ",
    "villainName": "å¯¹æ‰‹æ˜µç§°",
    "villainHands": "æ‰‹æ•°",
    "villainVPIP": "å…¥å±€ç‡",
    "villainWinRate": "èƒœç‡",
    "villainShowdown": "æ‘Šç‰Œç‡"
}

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`
            }];

            // æ·»åŠ å›¾ç‰‡
            if (uploadedImages.hand) {
                const [header, data] = uploadedImages.hand.split(',');
                const mimeType = header.match(/:(.*?);/)[1];
                parts.push({ inline_data: { mime_type: mimeType, data: data } });
            }
            
            if (uploadedImages.opponent) {
                const [header, data] = uploadedImages.opponent.split(',');
                const mimeType = header.match(/:(.*?);/)[1];
                parts.push({ inline_data: { mime_type: mimeType, data: data } });
            }

            const response = await fetch(`${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts }],
                    generationConfig: { temperature: 0.1, maxOutputTokens: 2048 }
                })
            });

            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.error?.message || 'è¯†åˆ«å¤±è´¥ï¼Œè¯·æ£€æŸ¥VPN');
            }

            const data = await response.json();
            const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
            
            // è§£æJSON
            try {
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (e) {
                console.warn('JSON parse error:', e);
            }
            
            return {};
        }

        function fillOCRResults(result) {
            document.getElementById('cfmBlinds').value = result.blinds || '';
            document.getElementById('cfmPot').value = result.pot || '';
            document.getElementById('cfmMyHand').value = result.myHand || '';
            document.getElementById('cfmPosition').value = result.position || '';
            document.getElementById('cfmBoard').value = result.board || '';
            document.getElementById('cfmVillainHand').value = result.villainHand || '';
            document.getElementById('cfmAction').value = result.action || '';
            document.getElementById('cfmResult').value = result.result || '';
            document.getElementById('cfmVillainName').value = result.villainName || '';
            document.getElementById('cfmVillainHands').value = result.villainHands || '';
            document.getElementById('cfmVillainVPIP').value = result.villainVPIP || '';
            document.getElementById('cfmVillainWinRate').value = result.villainWinRate || '';
            document.getElementById('cfmVillainShowdown').value = result.villainShowdown || '';
        }

        // ==================== æ”¶é›†ç¡®è®¤æ•°æ® ====================
        function collectConfirmedData() {
            return {
                blinds: document.getElementById('cfmBlinds').value.trim(),
                pot: document.getElementById('cfmPot').value.trim(),
                myHand: document.getElementById('cfmMyHand').value.trim(),
                position: document.getElementById('cfmPosition').value.trim(),
                board: document.getElementById('cfmBoard').value.trim(),
                villainHand: document.getElementById('cfmVillainHand').value.trim(),
                action: document.getElementById('cfmAction').value.trim(),
                result: document.getElementById('cfmResult').value.trim(),
                villainName: document.getElementById('cfmVillainName').value.trim(),
                villainHands: document.getElementById('cfmVillainHands').value.trim(),
                villainVPIP: document.getElementById('cfmVillainVPIP').value.trim(),
                villainWinRate: document.getElementById('cfmVillainWinRate').value.trim(),
                villainShowdown: document.getElementById('cfmVillainShowdown').value.trim()
            };
        }

        // ==================== æ„å»ºåˆ†ææç¤ºè¯ ====================
        function buildAnalysisPrompt(data) {
            const username = document.getElementById('username').value || 'Luckywm';
            const stackDepth = document.getElementById('stackDepth').value || '200-300';

            return `ä½ æ˜¯ä¸–ç•Œé¡¶çº§å¾·å·æ‰‘å…‹èŒä¸šé€‰æ‰‹å’Œæ•™ç»ƒï¼Œæ‹¥æœ‰20å¹´é«˜çº§åˆ«æ·±ç­¹ç ç°é‡‘å±€ç»éªŒã€‚

## ç”¨æˆ·å·²ç¡®è®¤çš„æ‰‹ç‰Œä¿¡æ¯

- **ç©å®¶æ˜µç§°**: ${username}
- **ç­¹ç æ·±åº¦**: ${stackDepth}BB
- **ç›²æ³¨ç»“æ„**: ${data.blinds || 'æœªçŸ¥'}
- **åº•æ± å¤§å°**: ${data.pot || 'æœªçŸ¥'}
- **${username}çš„æ‰‹ç‰Œ**: ${data.myHand || 'æœªçŸ¥'}
- **${username}çš„ä½ç½®**: ${data.position || 'æœªçŸ¥'}
- **å…¬å…±ç‰Œ**: ${data.board || 'æœªçŸ¥'}
- **å¯¹æ‰‹æ‰‹ç‰Œ**: ${data.villainHand || 'æœªçŸ¥'}
- **è¡ŒåŠ¨è®°å½•**: ${data.action || 'æœªçŸ¥'}
- **æœ€ç»ˆç»“æœ**: ${data.result || 'æœªçŸ¥'}

## å¯¹æ‰‹ç»Ÿè®¡æ•°æ®

- **å¯¹æ‰‹æ˜µç§°**: ${data.villainName || 'æœªçŸ¥'}
- **æœ¬çº§åˆ«æ‰‹æ•°**: ${data.villainHands || 'æœªçŸ¥'}
- **å…¥å±€ç‡(VPIP)**: ${data.villainVPIP || 'æœªçŸ¥'}
- **èƒœç‡**: ${data.villainWinRate || 'æœªçŸ¥'}
- **æ‘Šç‰Œç‡**: ${data.villainShowdown || 'æœªçŸ¥'}

---

## è¯·æŒ‰ä»¥ä¸‹æ¡†æ¶è¿›è¡Œæ·±åº¦åˆ†æï¼š

### 1ï¸âƒ£ ä¿¡æ¯ç¡®è®¤
ç¡®è®¤ä½ ç†è§£çš„ç‰Œå±€ä¿¡æ¯æ˜¯å¦æ­£ç¡®

### 2ï¸âƒ£ å¯¹æ‰‹ç±»å‹åˆ†æ
æ ¹æ®VPIP/æ‘Šç‰Œç‡åˆ¤æ–­å¯¹æ‰‹ç±»å‹ï¼ˆLAG/TAG/LP/TP/Fishï¼‰

### 3ï¸âƒ£ é€è¡—è¯¦ç»†åˆ†æ

**ç¿»å‰ (Preflop)**
- ${username}çš„èµ·æ‰‹ç‰Œå¼ºåº¦è¯„ä¼°
- ä½ç½®ä¼˜åŠ£åˆ†æ
- è¡ŒåŠ¨æ˜¯å¦æ­£ç¡®ï¼ŸåŠ æ³¨å°ºå¯¸æ˜¯å¦åˆç†ï¼Ÿ

**ç¿»ç‰Œ (Flop)**
- ç‰Œé¢ç»“æ„åˆ†æ
- ${username}çš„èŒƒå›´ä¼˜åŠ¿/åŠ£åŠ¿
- è¡ŒåŠ¨é€‰æ‹©æ˜¯å¦æ­£ç¡®ï¼Ÿ

**è½¬ç‰Œ (Turn)**
- è½¬ç‰Œå½±å“åˆ†æ
- è¡ŒåŠ¨æ˜¯å¦åˆç†ï¼Ÿ

**æ²³ç‰Œ (River)**
- æœ€ç»ˆç‰ŒåŠ›åˆ†æ
- è¡ŒåŠ¨æ˜¯å¦æ­£ç¡®ï¼Ÿ

### 4ï¸âƒ£ å…³é”®é”™è¯¯åˆ†æ
æŒ‡å‡º${username}çš„1-2ä¸ªæœ€å¤§é”™è¯¯ï¼ˆå¦‚æœ‰ï¼‰ï¼Œå¹¶ç»™å‡ºæ­£ç¡®æ‰“æ³•

### 5ï¸âƒ£ æ€»ç»“è¯„åˆ†

**æ•´ä½“è¯„ä»·**: [ä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/éœ€æ”¹è¿›]
**è¯„åˆ†**: X/10
**ä¸€å¥è¯æ€»ç»“**: 

è¯·å¼€å§‹åˆ†æï¼š`;
        }

        // ==================== AIåˆ†æ ====================
        async function analyzeHand() {
            const data = collectConfirmedData();
            
            if (!data.myHand) {
                showError('è¯·è‡³å°‘å¡«å†™ä½ çš„æ‰‹ç‰Œ');
                return;
            }

            const btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            btn.classList.add('loading');
            setStep(3);

            const aiName = selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1';
            addLog(`ğŸš€ å¼€å§‹${aiName}æ·±åº¦åˆ†æ...`, 'info');

            try {
                const prompt = buildAnalysisPrompt(data);
                
                addLog('â³ AIåˆ†æä¸­ï¼Œé¢„è®¡30-60ç§’...', 'info');

                let result;
                if (selectedAI === 'gemini') {
                    result = await callGemini(prompt);
                } else {
                    result = await callDeepSeek(prompt);
                }

                addLog('âœ… åˆ†æå®Œæˆï¼', 'success');
                displayResult(result.text, result.thinking);
                showSuccess('åˆ†æå®Œæˆï¼');

            } catch (error) {
                console.error('Analysis Error:', error);
                addLog(`âŒ ${error.message}`, 'error');
                showError(error.message);
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }

        async function callGemini(prompt) {
            const response = await fetch(`${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.7, maxOutputTokens: 8192 }
                })
            });

            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                let msg = err.error?.message || `é”™è¯¯: ${response.status}`;
                if (msg.includes('location')) msg = 'è¯·å¼€å¯VPN';
                throw new Error(msg);
            }

            const data = await response.json();
            return { text: data.candidates?.[0]?.content?.parts?.[0]?.text || '', thinking: null };
        }

        async function callDeepSeek(prompt) {
            const response = await fetch(CONFIG.DEEPSEEK_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${CONFIG.DEEPSEEK_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'deepseek-reasoner',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 8192
                })
            });

            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.error?.message || `DeepSeeké”™è¯¯: ${response.status}`);
            }

            const data = await response.json();
            const choice = data.choices?.[0];
            return {
                text: choice?.message?.content || '',
                thinking: choice?.message?.reasoning_content || null
            };
        }

        // ==================== æ˜¾ç¤ºç»“æœ ====================
        function displayResult(text, thinking) {
            const resultSection = document.getElementById('resultSection');
            const resultText = document.getElementById('resultText');
            const badge = document.getElementById('resultAiBadge');
            const thinkingSection = document.getElementById('thinkingSection');
            
            badge.textContent = selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1';
            badge.className = `result-ai-badge ${selectedAI}`;
            
            if (thinking) {
                thinkingSection.style.display = 'block';
                document.getElementById('thinkingContent').textContent = thinking;
            } else {
                thinkingSection.style.display = 'none';
            }

            // Markdownæ¸²æŸ“
            let html = text
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/^---$/gim, '<hr>')
                .replace(/^[\-\*] (.*)$/gim, '<li>$1</li>')
                .replace(/^\d+\. (.*)$/gim, '<li>$1</li>');

            html = html.replace(/(<li>[\s\S]*?<\/li>)+/g, match => `<ul>${match}</ul>`);
            html = html.replace(/\n/g, '<br>');
            html = html.replace(/<br>\s*<br>/g, '<br>');
            html = html.replace(/<\/(h[123]|li|ul|hr|pre)><br>/g, '</$1>');

            resultText.innerHTML = html;
            resultSection.classList.add('visible');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleThinking() {
            const content = document.getElementById('thinkingContent');
            const toggle = document.getElementById('thinkingToggle');
            content.classList.toggle('visible');
            toggle.textContent = content.classList.contains('visible') ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€';
        }

        // ==================== é‡ç½® ====================
        function resetAll() {
            uploadedImages = { hand: null, opponent: null };
            ocrCompleted = false;
            
            clearImage('hand');
            clearImage('opponent');
            
            document.getElementById('confirmSection').classList.remove('visible');
            document.getElementById('resultSection').classList.remove('visible');
            
            // æ¸…ç©ºç¡®è®¤è¡¨å•
            ['cfmBlinds', 'cfmPot', 'cfmMyHand', 'cfmPosition', 'cfmBoard', 'cfmVillainHand', 
             'cfmAction', 'cfmResult', 'cfmVillainName', 'cfmVillainHands', 'cfmVillainVPIP', 
             'cfmVillainWinRate', 'cfmVillainShowdown'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            setStep(1);
            addLog('ğŸ”„ å·²é‡ç½®', 'info');
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function addLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${type}">${message}</span>`;
            logContent.appendChild(logItem);
            logContent.scrollTop = logContent.scrollHeight;
        }

        function showError(message) {
            const toast = document.getElementById('errorToast');
            toast.textContent = message;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 5000);
        }

        function showSuccess(message) {
            const toast = document.getElementById('successToast');
            toast.textContent = message;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 3000);
        }

        function copyResult() {
            navigator.clipboard.writeText(document.getElementById('resultText').innerText)
                .then(() => { showSuccess('å·²å¤åˆ¶'); addLog('ğŸ“‹ å·²å¤åˆ¶', 'success'); })
                .catch(() => addLog('âŒ å¤åˆ¶å¤±è´¥', 'error'));
        }

        // ==================== åˆå§‹åŒ– ====================
        addLog('ğŸ® å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ v4.0', 'info');
        addLog('ğŸ“Œ æµç¨‹ï¼šä¸Šä¼ æˆªå›¾ â†’ OCRè¯†åˆ« â†’ ç¡®è®¤/ä¿®æ­£ â†’ AIåˆ†æ', 'info');
    </script>
</body>
</html>
