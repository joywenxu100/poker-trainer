<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ | Quick Hand Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-card-hover: #22222e;
            --accent-gold: #ffd700;
            --accent-green: #00d4aa;
            --accent-red: #ff4757;
            --accent-blue: #4a9eff;
            --accent-purple: #a855f7;
            --accent-orange: #ff9500;
            --text-primary: #f5f5f7;
            --text-secondary: #a0a0a8;
            --text-muted: #6a6a72;
            --border-color: #2a2a36;
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            --shadow-glow: 0 0 40px rgba(255, 215, 0, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-decoration {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }

        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 48px; margin-bottom: 10px; }
        .title {
            font-size: 32px; font-weight: 700;
            background: var(--gradient-gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 8px; }

        .main-panel {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        /* AI é€‰æ‹©å™¨ */
        .ai-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .ai-option {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .ai-option:hover { border-color: var(--accent-gold); }

        .ai-option.active.gemini {
            border-color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }

        .ai-option.active.deepseek {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.1);
        }

        .ai-option .ai-icon { font-size: 32px; margin-bottom: 10px; }
        .ai-option .ai-name { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .ai-option .ai-desc { font-size: 12px; color: var(--text-muted); }

        .ai-option.gemini .ai-name { color: var(--accent-blue); }
        .ai-option.deepseek .ai-name { color: var(--accent-purple); }

        .ai-badge {
            display: inline-block;
            padding: 2px 8px;
            font-size: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .ai-option.gemini .ai-badge { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .ai-option.deepseek .ai-badge { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        /* DeepSeekè­¦å‘Š */
        .deepseek-warning {
            display: none;
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid var(--accent-orange);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--accent-orange);
        }

        .deepseek-warning.visible { display: flex; align-items: center; gap: 12px; }
        .deepseek-warning .warning-icon { font-size: 24px; }

        /* è¾“å…¥æ¨¡å¼ */
        .input-mode-section { margin-bottom: 20px; }

        .mode-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .mode-row, .input-section, .ai-selector { 
                grid-template-columns: 1fr; 
                flex-direction: column;
            }
        }

        .mode-group {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px;
        }

        .mode-label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .mode-toggle { display: flex; gap: 8px; }

        .mode-btn {
            flex: 1;
            padding: 10px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover { border-color: var(--accent-gold); color: var(--text-primary); }

        .mode-btn.active {
            background: var(--gradient-gold);
            color: #000;
            border-color: var(--accent-gold);
            font-weight: 500;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-panel { min-height: 200px; }
        .input-panel.hidden { display: none; }

        .upload-card {
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-card:hover { border-color: var(--accent-gold); }
        .upload-card.has-image { border-style: solid; border-color: var(--accent-green); }
        .upload-card input[type="file"] { display: none; }

        .upload-icon { font-size: 40px; margin-bottom: 12px; }
        .upload-title { font-size: 16px; font-weight: 500; margin-bottom: 6px; }
        .upload-desc { font-size: 12px; color: var(--text-muted); }

        .upload-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }

        .upload-card.has-image .upload-preview { display: block; }
        .upload-card.has-image .upload-placeholder { display: none; }

        .clear-btn {
            display: none;
            position: absolute;
            top: 10px; right: 10px;
            padding: 6px 12px;
            font-size: 11px;
            color: white;
            background: var(--accent-red);
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .upload-card.has-image .clear-btn { display: block; }

        /* æ‰‹åŠ¨è¾“å…¥å¡ç‰‡ */
        .manual-input-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            height: 100%;
        }

        .manual-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--accent-gold);
            margin-bottom: 15px;
        }

        .manual-form { display: flex; flex-direction: column; gap: 12px; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-group.full { grid-column: 1 / -1; }
        .form-group label { font-size: 12px; color: var(--text-muted); }

        .setting-input {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
        }

        .setting-input:focus { outline: none; border-color: var(--accent-gold); }

        .setting-input.textarea {
            min-height: 80px;
            resize: vertical;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        /* è®¾ç½®åŒºåŸŸ */
        .settings-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--accent-gold);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .setting-item { display: flex; flex-direction: column; gap: 6px; }
        .setting-label { font-size: 12px; color: var(--text-secondary); }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: var(--accent-gold);
        }

        /* åˆ†ææŒ‰é’® */
        .analyze-btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            background: var(--gradient-gold);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .analyze-btn .spinner {
            display: none;
            width: 20px; height: 20px;
            border: 2px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .analyze-btn.loading .spinner { display: block; }
        .analyze-btn.loading .btn-text { display: none; }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ç»“æœåŒºåŸŸ */
        .result-section { margin-top: 30px; display: none; }
        .result-section.visible { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .result-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-ai-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .result-ai-badge.gemini { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .result-ai-badge.deepseek { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }

        .copy-btn {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }

        .result-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .result-text {
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-primary);
            word-wrap: break-word;
        }

        .result-text h1, .result-text h2, .result-text h3 {
            color: var(--accent-gold);
            margin: 18px 0 10px 0;
        }

        .result-text h1 { font-size: 22px; }
        .result-text h2 { font-size: 18px; }
        .result-text h3 { font-size: 15px; }

        .result-text strong { color: var(--accent-green); }
        .result-text em { color: var(--text-secondary); font-style: italic; }

        .result-text code {
            background: var(--bg-card);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-blue);
            font-size: 12px;
        }

        .result-text pre {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            border: 1px solid var(--border-color);
        }

        .result-text pre code { background: transparent; padding: 0; color: var(--text-secondary); }
        .result-text ul, .result-text ol { margin: 10px 0; padding-left: 20px; }
        .result-text li { margin: 6px 0; }
        .result-text hr { border: none; border-top: 1px solid var(--border-color); margin: 15px 0; }

        /* æ€è€ƒè¿‡ç¨‹ */
        .thinking-section {
            margin-bottom: 20px;
            background: rgba(168, 85, 247, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 12px;
            overflow: hidden;
        }

        .thinking-header {
            padding: 12px 20px;
            background: rgba(168, 85, 247, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: var(--accent-purple);
        }

        .thinking-header:hover { background: rgba(168, 85, 247, 0.15); }

        .thinking-content {
            padding: 20px;
            display: none;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.7;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .thinking-content.visible { display: block; }

        /* æ—¥å¿— */
        .log-section {
            margin-top: 25px;
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-title { font-size: 12px; color: var(--text-muted); margin-bottom: 10px; }
        .log-content { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .log-item { padding: 3px 0; border-bottom: 1px solid var(--border-color); }
        .log-item:last-child { border-bottom: none; }
        .log-time { color: var(--text-muted); margin-right: 8px; }
        .log-success { color: var(--accent-green); }
        .log-error { color: var(--accent-red); }
        .log-info { color: var(--accent-blue); }
        .log-warning { color: var(--accent-orange); }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px; right: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            z-index: 1000;
            display: none;
            max-width: 350px;
        }

        .toast.visible { display: block; animation: slideIn 0.3s ease; }
        .toast.error { background: var(--accent-red); color: white; }
        .toast.success { background: var(--accent-green); color: white; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
        }

        .footer a { color: var(--accent-gold); text-decoration: none; }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="toast error" id="errorToast"></div>
    <div class="toast success" id="successToast"></div>

    <div class="container">
        <header class="header">
            <div class="logo">ğŸƒ</div>
            <h1 class="title">å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜</h1>
            <p class="subtitle">åŒAIå¼•æ“ Â· Gemini + DeepSeekæ·±åº¦æ€è€ƒ Â· æ”¯æŒæˆªå›¾/æ‰‹åŠ¨è¾“å…¥</p>
        </header>

        <main class="main-panel">
            <!-- AI é€‰æ‹©å™¨ -->
            <div class="ai-selector">
                <div class="ai-option gemini active" onclick="selectAI('gemini')">
                    <div class="ai-icon">ğŸŒ</div>
                    <div class="ai-name">Google Gemini</div>
                    <div class="ai-desc">å¼ºå¤§çš„å¤šæ¨¡æ€AIï¼Œå›¾åƒè¯†åˆ«ç²¾å‡†</div>
                    <div class="ai-badge">éœ€è¦VPN</div>
                </div>
                <div class="ai-option deepseek" onclick="selectAI('deepseek')">
                    <div class="ai-icon">ğŸ§ </div>
                    <div class="ai-name">DeepSeek R1</div>
                    <div class="ai-desc">æ·±åº¦æ€è€ƒæ¨¡å¼ï¼Œæ¨ç†èƒ½åŠ›å¼º</div>
                    <div class="ai-badge">å›½å†…å¯ç”¨</div>
                </div>
            </div>

            <!-- DeepSeekè­¦å‘Š -->
            <div class="deepseek-warning" id="deepseekWarning">
                <span class="warning-icon">ğŸ§ </span>
                <span><strong>DeepSeekæ¨¡å¼ï¼š</strong>è¯·ä½¿ç”¨<strong>æ‰‹åŠ¨è¾“å…¥</strong>å¡«å†™æ‰‹ç‰Œä¿¡æ¯å’Œå¯¹æ‰‹æ•°æ®ã€‚å¦‚éœ€æˆªå›¾è¯†åˆ«è¯·åˆ‡æ¢åˆ°Geminiï¼ˆéœ€VPNï¼‰ã€‚</span>
            </div>

            <!-- è¾“å…¥æ¨¡å¼é€‰æ‹© -->
            <div class="input-mode-section">
                <div class="mode-row">
                    <div class="mode-group">
                        <label class="mode-label">ğŸ“‹ æ‰‹ç‰Œä¿¡æ¯</label>
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="hand-image" onclick="switchMode('hand', 'image')">ğŸ“· æˆªå›¾</button>
                            <button class="mode-btn" data-mode="hand-manual" onclick="switchMode('hand', 'manual')">âŒ¨ï¸ æ‰‹åŠ¨</button>
                        </div>
                    </div>
                    <div class="mode-group">
                        <label class="mode-label">ğŸ“Š å¯¹æ‰‹æ•°æ®</label>
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="opponent-image" onclick="switchMode('opponent', 'image')">ğŸ“· æˆªå›¾</button>
                            <button class="mode-btn" data-mode="opponent-manual" onclick="switchMode('opponent', 'manual')">âŒ¨ï¸ æ‰‹åŠ¨</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <!-- æ‰‹ç‰Œæˆªå›¾ -->
                <div class="input-panel" id="handImagePanel">
                    <div class="upload-card" id="handCard" onclick="triggerUpload('hand', event)">
                        <input type="file" id="handInput" accept="image/*" onchange="handleImageUpload(this, 'hand')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ´</div>
                            <div class="upload-title">ä¸Šä¼ æ‰‹ç‰Œæˆªå›¾</div>
                            <div class="upload-desc">ç‰Œå±€å›é¡¾ç•Œé¢</div>
                        </div>
                        <img class="upload-preview" id="handPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('hand'); event.stopPropagation();">âœ• é‡æ–°ä¸Šä¼ </button>
                    </div>
                </div>

                <!-- æ‰‹ç‰Œæ‰‹åŠ¨è¾“å…¥ -->
                <div class="input-panel hidden" id="handManualPanel">
                    <div class="manual-input-card">
                        <div class="manual-title">ğŸ´ æ‰‹åŠ¨è¾“å…¥æ‰‹ç‰Œ</div>
                        <div class="manual-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ç›²æ³¨ç»“æ„</label>
                                    <input type="text" id="manualBlinds" placeholder="å¦‚: 2/4/8" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>åº•æ± å¤§å°</label>
                                    <input type="text" id="manualPot" placeholder="å¦‚: 959.3" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ä½ çš„æ‰‹ç‰Œ</label>
                                    <input type="text" id="manualMyHand" placeholder="å¦‚: KsAd (é»‘æ¡ƒKæ–¹å—A)" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>ä½ çš„ä½ç½®</label>
                                    <select id="manualPosition" class="setting-input">
                                        <option value="">é€‰æ‹©ä½ç½®</option>
                                        <option value="SB">å°ç›² (SB)</option>
                                        <option value="BB">å¤§ç›² (BB)</option>
                                        <option value="Straddle">Straddle</option>
                                        <option value="UTG">æªå£ (UTG)</option>
                                        <option value="MP">ä¸­ä½ (MP)</option>
                                        <option value="CO">å…³ç… (CO)</option>
                                        <option value="BTN">æŒ‰é’® (BTN)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group full">
                                <label>å…¬å…±ç‰Œ (ç”¨ç©ºæ ¼åˆ†éš”)</label>
                                <input type="text" id="manualBoard" placeholder="å¦‚: Jc Qc 7c 5s 5h" class="setting-input">
                            </div>
                            <div class="form-group full">
                                <label>å¯¹æ‰‹æ‰‹ç‰Œï¼ˆå¦‚å·²çŸ¥ï¼‰</label>
                                <input type="text" id="manualVillainHand" placeholder="å¦‚: JdJh (æ–¹å—Jçº¢æ¡ƒJ)" class="setting-input">
                            </div>
                            <div class="form-group full">
                                <label>è¡ŒåŠ¨è®°å½•</label>
                                <textarea id="manualAction" class="setting-input textarea" placeholder="ç¿»å‰: HeroåŠ æ³¨458.2, xiaolv All-in 436.4
ç¿»ç‰Œ(Jc Qc 7c): ...
è½¬ç‰Œ(5s): ...
æ²³ç‰Œ(5h): ..."></textarea>
                            </div>
                            <div class="form-group full">
                                <label>ç»“æœ</label>
                                <input type="text" id="manualResult" placeholder="å¦‚: Heroè¾“438.5, xiaolvèµ¢422.2" class="setting-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¯¹æ‰‹æˆªå›¾ -->
                <div class="input-panel" id="opponentImagePanel">
                    <div class="upload-card" id="opponentCard" onclick="triggerUpload('opponent', event)">
                        <input type="file" id="opponentInput" accept="image/*" onchange="handleImageUpload(this, 'opponent')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ‘¤</div>
                            <div class="upload-title">ä¸Šä¼ å¯¹æ‰‹æ•°æ®</div>
                            <div class="upload-desc">å¯¹æ‰‹é¢æ¿æˆªå›¾</div>
                        </div>
                        <img class="upload-preview" id="opponentPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('opponent'); event.stopPropagation();">âœ• é‡æ–°ä¸Šä¼ </button>
                    </div>
                </div>

                <!-- å¯¹æ‰‹æ‰‹åŠ¨è¾“å…¥ -->
                <div class="input-panel hidden" id="opponentManualPanel">
                    <div class="manual-input-card">
                        <div class="manual-title">ğŸ‘¤ æ‰‹åŠ¨è¾“å…¥å¯¹æ‰‹æ•°æ®</div>
                        <div class="manual-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å¯¹æ‰‹æ˜µç§°</label>
                                    <input type="text" id="manualVillainName" placeholder="å¦‚: xiaolv" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>æœ¬çº§åˆ«æ‰‹æ•°</label>
                                    <input type="text" id="manualVillainHands" placeholder="å¦‚: 8446" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å…¥å±€ç‡ VPIP (%)</label>
                                    <input type="text" id="manualVillainVPIP" placeholder="å¦‚: 45" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>èƒœç‡ (%)</label>
                                    <input type="text" id="manualVillainWinRate" placeholder="å¦‚: 20" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>æ‘Šç‰Œç‡ (%)</label>
                                    <input type="text" id="manualVillainShowdown" placeholder="å¦‚: 13" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>å¤‡æ³¨/é£æ ¼</label>
                                    <input type="text" id="manualVillainNotes" placeholder="å¦‚: æ¾å‡¶ç©å®¶" class="setting-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½® -->
            <div class="settings-section">
                <div class="settings-title">âš™ï¸ åˆ†æè®¾ç½®</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">ä½ çš„æ˜µç§° (åŒºåˆ†å¤§å°å†™)</label>
                        <input type="text" class="setting-input" id="username" value="Luckywm">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">ç­¹ç æ·±åº¦ (BB)</label>
                        <input type="text" class="setting-input" id="stackDepth" placeholder="é»˜è®¤: 200-300">
                    </div>
                    <div class="setting-item">
                        <label class="checkbox-item">
                            <input type="checkbox" id="isShortStack" onchange="toggleShortStack()">
                            <span>å¯¹æ‰‹æ˜¯çŸ­ç </span>
                        </label>
                    </div>
                    <div class="setting-item" id="shortStackInput" style="display: none;">
                        <label class="setting-label">å¯¹æ‰‹ç­¹ç  (BB)</label>
                        <input type="text" class="setting-input" id="opponentStack" placeholder="å¦‚: 50">
                    </div>
                </div>
            </div>

            <!-- åˆ†ææŒ‰é’® -->
            <button class="analyze-btn" id="analyzeBtn" onclick="analyzeHand()">
                <span class="spinner"></span>
                <span class="btn-text">ğŸš€ å¼€å§‹AIå¤ç›˜åˆ†æ</span>
            </button>

            <!-- ç»“æœåŒºåŸŸ -->
            <section class="result-section" id="resultSection">
                <div class="result-header">
                    <h2 class="result-title">
                        <span>ğŸ“Š</span>
                        <span>åˆ†æç»“æœ</span>
                        <span class="result-ai-badge" id="resultAiBadge"></span>
                    </h2>
                    <button class="copy-btn" onclick="copyResult()">ğŸ“‹ å¤åˆ¶</button>
                </div>
                
                <!-- DeepSeekæ€è€ƒè¿‡ç¨‹ -->
                <div class="thinking-section" id="thinkingSection" style="display: none;">
                    <div class="thinking-header" onclick="toggleThinking()">
                        <span>ğŸ§  DeepSeek æ€è€ƒè¿‡ç¨‹</span>
                        <span id="thinkingToggle">â–¼ å±•å¼€</span>
                    </div>
                    <div class="thinking-content" id="thinkingContent"></div>
                </div>
                
                <div class="result-content">
                    <div class="result-text" id="resultText"></div>
                </div>
            </section>

            <!-- æ—¥å¿— -->
            <div class="log-section">
                <div class="log-title">ğŸ“ è¿è¡Œæ—¥å¿—</div>
                <div class="log-content" id="logContent">
                    <div class="log-item">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span class="log-info">å·¥å…·å·²å°±ç»ª</span>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>åŒAIå¼•æ“ï¼šGemini + DeepSeek Â· <a href="index.html">è¿”å›ä¸»é¡µ</a></p>
        </footer>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const CONFIG = {
            GEMINI_API_KEY: 'AIzaSyCGLHoZLcXU7oQiKXT9929PZwal1UenRjY',
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
            DEEPSEEK_API_KEY: 'sk-e4f2758c58d14807bc9004539ffbb0e8',
            DEEPSEEK_API_URL: 'https://api.deepseek.com/chat/completions',
            DEFAULT_USERNAME: 'Luckywm',
            DEFAULT_STACK_DEPTH: '200-300',
            REQUEST_TIMEOUT: 120000 // 2åˆ†é’Ÿè¶…æ—¶
        };

        // çŠ¶æ€
        let selectedAI = 'gemini';
        let uploadedImages = { hand: null, opponent: null };
        let inputModes = { hand: 'image', opponent: 'image' };

        // ==================== AI é€‰æ‹© ====================
        function selectAI(ai) {
            // DeepSeekä¸æ”¯æŒå›¾ç‰‡ï¼Œå¦‚æœå½“å‰æ˜¯æˆªå›¾æ¨¡å¼åˆ™è‡ªåŠ¨åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥
            if (ai === 'deepseek') {
                if (inputModes.hand === 'image' || inputModes.opponent === 'image') {
                    // è‡ªåŠ¨åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼
                    if (inputModes.hand === 'image') {
                        switchMode('hand', 'manual');
                    }
                    if (inputModes.opponent === 'image') {
                        switchMode('opponent', 'manual');
                    }
                    addLog('âš ï¸ DeepSeekä¸æ”¯æŒå›¾ç‰‡ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼', 'warning');
                    showError('DeepSeekä¸æ”¯æŒå›¾ç‰‡è¯†åˆ«ï¼Œå·²åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥');
                }
            }
            
            selectedAI = ai;
            document.querySelectorAll('.ai-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`.ai-option.${ai}`).classList.add('active');
            
            // æ›´æ–°è­¦å‘Šæ˜¾ç¤º
            updateDeepSeekWarning();
            
            addLog(`ğŸ¤– åˆ‡æ¢åˆ° ${ai === 'gemini' ? 'Google Gemini' : 'DeepSeek R1 æ·±åº¦æ€è€ƒ'}`, 'info');
        }

        function updateDeepSeekWarning() {
            const warning = document.getElementById('deepseekWarning');
            // DeepSeekæ¨¡å¼ä¸‹å§‹ç»ˆæ˜¾ç¤ºæç¤º
            warning.classList.toggle('visible', selectedAI === 'deepseek');
        }

        // ==================== æ¨¡å¼åˆ‡æ¢ ====================
        function switchMode(type, mode) {
            // å¦‚æœé€‰æ‹©æˆªå›¾æ¨¡å¼ä½†å½“å‰æ˜¯DeepSeekï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°Gemini
            if (mode === 'image' && selectedAI === 'deepseek') {
                selectAI('gemini');
                addLog('ğŸ“· æˆªå›¾æ¨¡å¼éœ€è¦Geminiï¼Œå·²è‡ªåŠ¨åˆ‡æ¢', 'warning');
                showError('æˆªå›¾è¯†åˆ«éœ€è¦Geminiï¼ˆéœ€VPNï¼‰ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢');
            }
            
            inputModes[type] = mode;
            document.querySelectorAll(`.mode-btn[data-mode^="${type}-"]`).forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === `${type}-${mode}`);
            });
            document.getElementById(`${type}ImagePanel`).classList.toggle('hidden', mode !== 'image');
            document.getElementById(`${type}ManualPanel`).classList.toggle('hidden', mode !== 'manual');
            
            // æ›´æ–°DeepSeekè­¦å‘Š
            updateDeepSeekWarning();
        }

        function toggleShortStack() {
            document.getElementById('shortStackInput').style.display = 
                document.getElementById('isShortStack').checked ? 'block' : 'none';
        }

        // ==================== å›¾ç‰‡å¤„ç† ====================
        function triggerUpload(type, event) {
            if (event.target.classList.contains('clear-btn')) return;
            document.getElementById(`${type}Input`).click();
        }

        function handleImageUpload(input, type) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                showError('å›¾ç‰‡å¤ªå¤§ï¼Œæœ€å¤§10MB');
                return;
            }

            addLog(`ğŸ“· æ­£åœ¨å¤„ç†${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}å›¾ç‰‡...`, 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                compressImage(e.target.result, function(data) {
                    uploadedImages[type] = data;
                    document.getElementById(`${type}Preview`).src = data;
                    document.getElementById(`${type}Card`).classList.add('has-image');
                    addLog(`âœ… ${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}æˆªå›¾å·²ä¸Šä¼ `, 'success');
                });
            };
            reader.onerror = function() {
                showError('å›¾ç‰‡è¯»å–å¤±è´¥');
            };
            reader.readAsDataURL(file);
        }

        function compressImage(dataUrl, callback) {
            const img = new Image();
            img.onload = function() {
                const maxDim = 1600; // ç¨å¾®æé«˜åˆ†è¾¨ç‡ä»¥æå‡è¯†åˆ«ç‡
                let w = img.width, h = img.height;
                if (w > maxDim || h > maxDim) {
                    const ratio = Math.min(maxDim / w, maxDim / h);
                    w = Math.round(w * ratio);
                    h = Math.round(h * ratio);
                    const canvas = document.createElement('canvas');
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.9)); // æé«˜è´¨é‡
                } else {
                    callback(dataUrl);
                }
            };
            img.onerror = function() {
                callback(dataUrl);
            };
            img.src = dataUrl;
        }

        function clearImage(type) {
            uploadedImages[type] = null;
            document.getElementById(`${type}Preview`).src = '';
            document.getElementById(`${type}Card`).classList.remove('has-image');
            document.getElementById(`${type}Input`).value = '';
            addLog(`ğŸ—‘ï¸ å·²æ¸…é™¤${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}æˆªå›¾`, 'info');
        }

        // ==================== æ•°æ®æ”¶é›† ====================
        function collectManualHandData() {
            return {
                blinds: document.getElementById('manualBlinds').value.trim(),
                pot: document.getElementById('manualPot').value.trim(),
                myHand: document.getElementById('manualMyHand').value.trim(),
                position: document.getElementById('manualPosition').value,
                board: document.getElementById('manualBoard').value.trim(),
                villainHand: document.getElementById('manualVillainHand').value.trim(),
                action: document.getElementById('manualAction').value.trim(),
                result: document.getElementById('manualResult').value.trim()
            };
        }

        function collectManualOpponentData() {
            return {
                name: document.getElementById('manualVillainName').value.trim(),
                hands: document.getElementById('manualVillainHands').value.trim(),
                vpip: document.getElementById('manualVillainVPIP').value.trim(),
                winRate: document.getElementById('manualVillainWinRate').value.trim(),
                showdown: document.getElementById('manualVillainShowdown').value.trim(),
                notes: document.getElementById('manualVillainNotes').value.trim()
            };
        }

        function formatManualData(handData, opponentData) {
            let text = '';
            if (handData) {
                text += 'ã€æ‰‹ç‰Œä¿¡æ¯ - ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ã€‘\n';
                if (handData.blinds) text += `- ç›²æ³¨ç»“æ„: ${handData.blinds}\n`;
                if (handData.pot) text += `- æœ€ç»ˆåº•æ± : ${handData.pot}\n`;
                if (handData.myHand) text += `- Heroæ‰‹ç‰Œ: ${handData.myHand}\n`;
                if (handData.position) text += `- Heroä½ç½®: ${handData.position}\n`;
                if (handData.board) text += `- å…¬å…±ç‰Œ: ${handData.board}\n`;
                if (handData.villainHand) text += `- å¯¹æ‰‹æ‰‹ç‰Œ: ${handData.villainHand}\n`;
                if (handData.action) text += `- è¡ŒåŠ¨è®°å½•:\n${handData.action}\n`;
                if (handData.result) text += `- æœ€ç»ˆç»“æœ: ${handData.result}\n`;
            }
            if (opponentData) {
                text += '\nã€å¯¹æ‰‹æ•°æ® - ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ã€‘\n';
                if (opponentData.name) text += `- å¯¹æ‰‹æ˜µç§°: ${opponentData.name}\n`;
                if (opponentData.hands) text += `- æœ¬çº§åˆ«æ‰‹æ•°: ${opponentData.hands}\n`;
                if (opponentData.vpip) text += `- å…¥å±€ç‡(VPIP): ${opponentData.vpip}%\n`;
                if (opponentData.winRate) text += `- èƒœç‡: ${opponentData.winRate}%\n`;
                if (opponentData.showdown) text += `- æ‘Šç‰Œç‡: ${opponentData.showdown}%\n`;
                if (opponentData.notes) text += `- å¤‡æ³¨: ${opponentData.notes}\n`;
            }
            return text;
        }

        // ==================== æ„å»ºæç¤ºè¯ ====================
        function buildPrompt(manualText) {
            const username = document.getElementById('username').value || CONFIG.DEFAULT_USERNAME;
            const stackDepth = document.getElementById('stackDepth').value || CONFIG.DEFAULT_STACK_DEPTH;
            
            let inputDesc = '';
            const hasImageInput = inputModes.hand === 'image' || inputModes.opponent === 'image';
            
            if (inputModes.hand === 'image' && inputModes.opponent === 'image') {
                inputDesc = `## è¾“å…¥æ•°æ®ï¼šä¸¤å¼ ä¸­æ–‡ç•Œé¢æˆªå›¾

è¯·ä»”ç»†è¯†åˆ«æˆªå›¾å†…å®¹ï¼š
- **ç¬¬ä¸€å¼ å›¾ç‰‡**ï¼šç‰Œå±€å›é¡¾ç•Œé¢ï¼ˆåŒ…å«ç›²æ³¨ã€åº•æ± ã€æ‰€æœ‰ç©å®¶æ‰‹ç‰Œã€å…¬å…±ç‰Œã€ç›ˆäºï¼‰
- **ç¬¬äºŒå¼ å›¾ç‰‡**ï¼šå¯¹æ‰‹æ•°æ®é¢æ¿ï¼ˆåŒ…å«å…¥å±€ç‡ã€èƒœç‡ã€æ‘Šç‰Œç‡ã€æ‰‹æ•°ï¼‰

### æˆªå›¾è¯†åˆ«è¦ç‚¹ï¼š
1. ç›²æ³¨æ ¼å¼å¦‚ "2/4/8(2)" = å°ç›²2/å¤§ç›²4/Straddle8
2. çº¢è‰²ç‰ŒèƒŒè¡¨ç¤ºè¯¥ç©å®¶å¼ƒç‰Œ
3. ç»¿è‰²æ•°å­—=èµ¢ï¼Œçº¢è‰²æ•°å­—=è¾“
4. "è‘«èŠ¦"="Full House", "å¯¹å­"="Pair"`;
            } else if (inputModes.hand === 'manual' && inputModes.opponent === 'manual') {
                inputDesc = `## è¾“å…¥æ•°æ®ï¼šç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ï¼ˆè¯·ç›´æ¥ä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯ï¼‰

${manualText}`;
            } else if (inputModes.hand === 'image') {
                inputDesc = `## è¾“å…¥æ•°æ®ï¼šæ··åˆæ¨¡å¼

**æ‰‹ç‰Œä¿¡æ¯**ï¼šè¯·ä»æˆªå›¾è¯†åˆ«ï¼ˆç¬¬ä¸€å¼ å›¾ - ç‰Œå±€å›é¡¾ç•Œé¢ï¼‰

**å¯¹æ‰‹æ•°æ®**ï¼šç”¨æˆ·æ‰‹åŠ¨è¾“å…¥å¦‚ä¸‹
${manualText}`;
            } else {
                inputDesc = `## è¾“å…¥æ•°æ®ï¼šæ··åˆæ¨¡å¼

**æ‰‹ç‰Œä¿¡æ¯**ï¼šç”¨æˆ·æ‰‹åŠ¨è¾“å…¥å¦‚ä¸‹
${manualText}

**å¯¹æ‰‹æ•°æ®**ï¼šè¯·ä»æˆªå›¾è¯†åˆ«ï¼ˆå›¾ç‰‡ - å¯¹æ‰‹æ•°æ®é¢æ¿ï¼‰`;
            }

            return `ä½ æ˜¯ä¸–ç•Œé¡¶çº§å¾·å·æ‰‘å…‹èŒä¸šé€‰æ‰‹å’Œæ•™ç»ƒï¼Œæ‹¥æœ‰20å¹´é«˜çº§åˆ«æ·±ç­¹ç ç°é‡‘å±€ç»éªŒï¼Œç²¾é€šGTOå’Œå‰¥å‰Šç­–ç•¥ã€‚

## åŸºæœ¬ä¿¡æ¯
- **ç›®æ ‡ç©å®¶æ˜µç§°**: ${username}ï¼ˆè¯·åœ¨æˆªå›¾/æ•°æ®ä¸­æ‰¾åˆ°æ­¤ç©å®¶ï¼Œåˆ†æTAçš„å†³ç­–ï¼‰
- **ç­¹ç æ·±åº¦**: çº¦${stackDepth}BB
- **æ¸¸æˆç±»å‹**: æœ‰Straddleçš„ä¸­å›½çº¿ä¸Šç°é‡‘å±€

${inputDesc}

---

## åˆ†ææ¡†æ¶ï¼ˆè¯·ä¸¥æ ¼æŒ‰æ­¤ç»“æ„è¾“å‡ºï¼‰

### 1ï¸âƒ£ ä¿¡æ¯ç¡®è®¤
é¦–å…ˆåˆ—å‡ºä½ ä»æˆªå›¾/ç”¨æˆ·è¾“å…¥ä¸­è·å–çš„æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼š
- ç›²æ³¨ç»“æ„: 
- æœ€ç»ˆåº•æ± : 
- ${username}çš„æ‰‹ç‰Œ: 
- ${username}çš„ä½ç½®: 
- å…¬å…±ç‰Œ: Flop / Turn / River
- ä¸»è¦å¯¹æ‰‹åŠæ‰‹ç‰Œ:
- å¯¹æ‰‹ç»Ÿè®¡: æ‰‹æ•° / VPIP% / èƒœç‡% / æ‘Šç‰Œç‡%

### 2ï¸âƒ£ å¯¹æ‰‹ç±»å‹åˆ†æ
æ ¹æ®ç»Ÿè®¡æ•°æ®åˆ¤æ–­å¯¹æ‰‹ç±»å‹ï¼š
- VPIP>40% + ä½æ‘Šç‰Œç‡ = æ¾å‡¶(LAG)
- VPIP>40% + é«˜æ‘Šç‰Œç‡ = æ¾è¢«åŠ¨(Calling Station)
- VPIP<25% + ä½æ‘Šç‰Œç‡ = ç´§å‡¶(TAG)
- æ‰‹æ•°>500æ‰‹æ•°æ®æ‰å¯é 

### 3ï¸âƒ£ é€è¡—åˆ†æ

**ç¿»å‰ (Preflop)**
- ${username}çš„èµ·æ‰‹ç‰Œå¼ºåº¦
- ä½ç½®ä¼˜åŠ£
- è¡ŒåŠ¨æ˜¯å¦æ­£ç¡®ï¼ŸåŠ æ³¨å°ºå¯¸æ˜¯å¦åˆç†ï¼Ÿ

**ç¿»ç‰Œ (Flop)**
- ç‰Œé¢ç»“æ„ï¼ˆå¹²ç‡¥/æ¹¿æ¶¦/è¿æ¥ï¼‰
- ${username}åœ¨æ­¤ç‰Œé¢çš„èŒƒå›´ä¼˜åŠ¿
- è¡ŒåŠ¨é€‰æ‹©æ˜¯å¦æ­£ç¡®ï¼Ÿ

**è½¬ç‰Œ (Turn)**
- è½¬ç‰Œå¯¹åŒæ–¹èŒƒå›´çš„å½±å“
- è¡ŒåŠ¨æ˜¯å¦åˆç†ï¼Ÿ

**æ²³ç‰Œ (River)**
- æœ€ç»ˆç‰ŒåŠ›
- ä»·å€¼/è¯ˆå”¬/è¿‡ç‰Œçš„é€‰æ‹©

### 4ï¸âƒ£ å…³é”®é”™è¯¯åˆ†æ
æŒ‡å‡º${username}åœ¨æœ¬æ‰‹ç‰Œä¸­çš„1-2ä¸ªæœ€å¤§é”™è¯¯ï¼ˆå¦‚æœ‰ï¼‰ï¼š
- é”™è¯¯ç‚¹
- ä¸ºä»€ä¹ˆæ˜¯é”™è¯¯
- æ­£ç¡®æ‰“æ³•

### 5ï¸âƒ£ æ€»ç»“è¯„åˆ†

**æ•´ä½“è¯„ä»·**: [ä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/éœ€æ”¹è¿›]

**è¯„åˆ†**: X/10

**ä¸€å¥è¯æ€»ç»“**: 

---

è¯·å¼€å§‹åˆ†æï¼š`;
        }

        // ==================== éªŒè¯è¾“å…¥ ====================
        function validateInput() {
            // æ£€æŸ¥DeepSeek+æˆªå›¾æ¨¡å¼
            if (selectedAI === 'deepseek') {
                if (inputModes.hand === 'image' || inputModes.opponent === 'image') {
                    showError('DeepSeekä¸æ”¯æŒå›¾ç‰‡è¯†åˆ«ï¼Œè¯·åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æˆ–ä½¿ç”¨Gemini');
                    addLog('âš ï¸ DeepSeekéœ€è¦æ‰‹åŠ¨è¾“å…¥æ¨¡å¼', 'warning');
                    return false;
                }
            }
            
            if (inputModes.hand === 'image' && !uploadedImages.hand) {
                showError('è¯·ä¸Šä¼ æ‰‹ç‰Œæˆªå›¾æˆ–åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥');
                return false;
            }
            if (inputModes.hand === 'manual' && !document.getElementById('manualMyHand').value.trim()) {
                showError('è¯·è¾“å…¥ä½ çš„æ‰‹ç‰Œ');
                return false;
            }
            if (inputModes.opponent === 'image' && !uploadedImages.opponent) {
                showError('è¯·ä¸Šä¼ å¯¹æ‰‹æ•°æ®æˆªå›¾æˆ–åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥');
                return false;
            }
            if (inputModes.opponent === 'manual') {
                const vpip = document.getElementById('manualVillainVPIP').value.trim();
                if (!vpip) {
                    showError('è¯·è‡³å°‘è¾“å…¥å¯¹æ‰‹å…¥å±€ç‡');
                    return false;
                }
            }
            return true;
        }

        // ==================== APIè°ƒç”¨ï¼ˆå¸¦è¶…æ—¶ï¼‰ ====================
        async function fetchWithTimeout(url, options, timeout = CONFIG.REQUEST_TIMEOUT) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•');
                }
                throw error;
            }
        }

        // ==================== è°ƒç”¨ Gemini API ====================
        async function callGemini(prompt) {
            const parts = [{ text: prompt }];
            
            if (inputModes.hand === 'image' && uploadedImages.hand) {
                try {
                    const [header, data] = uploadedImages.hand.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    parts.push({ inline_data: { mime_type: mimeType, data: data } });
                } catch (e) {
                    throw new Error('æ‰‹ç‰Œå›¾ç‰‡æ ¼å¼é”™è¯¯');
                }
            }
            
            if (inputModes.opponent === 'image' && uploadedImages.opponent) {
                try {
                    const [header, data] = uploadedImages.opponent.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    parts.push({ inline_data: { mime_type: mimeType, data: data } });
                } catch (e) {
                    throw new Error('å¯¹æ‰‹æ•°æ®å›¾ç‰‡æ ¼å¼é”™è¯¯');
                }
            }

            const response = await fetchWithTimeout(
                `${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts }],
                        generationConfig: { 
                            temperature: 0.7, 
                            maxOutputTokens: 8192,
                            topP: 0.95
                        }
                    })
                }
            );

            if (!response.ok) {
                let errMsg = `Geminié”™è¯¯: ${response.status}`;
                try {
                    const err = await response.json();
                    errMsg = err.error?.message || errMsg;
                    if (errMsg.includes('location')) {
                        errMsg = 'æ‚¨çš„ç½‘ç»œä½ç½®ä¸æ”¯æŒGeminiï¼Œè¯·å¼€å¯VPN';
                    }
                } catch (e) {}
                throw new Error(errMsg);
            }

            const data = await response.json();
            const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (!text) {
                const reason = data.candidates?.[0]?.finishReason;
                if (reason === 'SAFETY') {
                    throw new Error('å†…å®¹è¢«å®‰å…¨è¿‡æ»¤ï¼Œè¯·é‡è¯•');
                }
                throw new Error('æœªè·å–åˆ°åˆ†æç»“æœ');
            }

            return { text, thinking: null };
        }

        // ==================== è°ƒç”¨ DeepSeek API ====================
        async function callDeepSeek(prompt) {
            const response = await fetchWithTimeout(
                CONFIG.DEEPSEEK_API_URL,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-reasoner',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 8192
                    })
                }
            );

            if (!response.ok) {
                let errMsg = `DeepSeeké”™è¯¯: ${response.status}`;
                try {
                    const err = await response.json();
                    errMsg = err.error?.message || errMsg;
                } catch (e) {}
                throw new Error(errMsg);
            }

            const data = await response.json();
            const choice = data.choices?.[0];
            
            if (!choice?.message?.content) {
                throw new Error('DeepSeekæœªè¿”å›ç»“æœ');
            }

            return {
                text: choice.message.content,
                thinking: choice.message.reasoning_content || null
            };
        }

        // ==================== ä¸»åˆ†æå‡½æ•° ====================
        async function analyzeHand() {
            if (!validateInput()) return;

            const btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            btn.classList.add('loading');

            const aiName = selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1';
            addLog(`ğŸš€ å¼€å§‹åˆ†æ (${aiName})...`, 'info');

            try {
                const handData = inputModes.hand === 'manual' ? collectManualHandData() : null;
                const opponentData = inputModes.opponent === 'manual' ? collectManualOpponentData() : null;
                const manualText = formatManualData(handData, opponentData);

                const prompt = buildPrompt(manualText);
                
                addLog('â³ AIåˆ†æä¸­ï¼Œé¢„è®¡30-60ç§’...', 'info');

                let result;
                if (selectedAI === 'gemini') {
                    result = await callGemini(prompt);
                } else {
                    result = await callDeepSeek(prompt);
                }

                addLog('âœ… åˆ†æå®Œæˆï¼', 'success');
                displayResult(result.text, result.thinking);
                showSuccess('åˆ†æå®Œæˆï¼');

            } catch (error) {
                console.error('Error:', error);
                let msg = error.message;
                
                if (msg.includes('Failed to fetch') || msg.includes('NetworkError')) {
                    msg = selectedAI === 'gemini' 
                        ? 'æ— æ³•è¿æ¥Geminiï¼Œè¯·æ£€æŸ¥VPNæ˜¯å¦å¼€å¯' 
                        : 'æ— æ³•è¿æ¥DeepSeekï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                }
                
                showError(msg);
                addLog(`âŒ ${msg}`, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }

        // ==================== æ˜¾ç¤ºç»“æœ ====================
        function displayResult(text, thinking) {
            const resultSection = document.getElementById('resultSection');
            const resultText = document.getElementById('resultText');
            const badge = document.getElementById('resultAiBadge');
            const thinkingSection = document.getElementById('thinkingSection');
            
            badge.textContent = selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1';
            badge.className = `result-ai-badge ${selectedAI}`;
            
            if (thinking) {
                thinkingSection.style.display = 'block';
                document.getElementById('thinkingContent').textContent = thinking;
            } else {
                thinkingSection.style.display = 'none';
            }

            // æ”¹è¿›çš„Markdownæ¸²æŸ“ï¼ˆå…¼å®¹Safariï¼‰
            let html = text
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*([^*]+)\*/g, '<em>$1</em>') // ç®€åŒ–æ–œä½“åŒ¹é…
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/^---$/gim, '<hr>')
                .replace(/^[\-\*] (.*)$/gim, '<li>$1</li>')
                .replace(/^\d+\. (.*)$/gim, '<li>$1</li>');

            // åŒ…è£…åˆ—è¡¨
            html = html.replace(/(<li>[\s\S]*?<\/li>)+/g, match => `<ul>${match}</ul>`);
            
            // æ¢è¡Œå¤„ç†
            html = html.replace(/\n/g, '<br>');
            html = html.replace(/<br>\s*<br>/g, '<br>');
            html = html.replace(/<\/(h[123]|li|ul|hr|pre)><br>/g, '</$1>');
            html = html.replace(/<br><(h[123]|ul|hr|pre)/g, '<$1');

            resultText.innerHTML = html;
            resultSection.classList.add('visible');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleThinking() {
            const content = document.getElementById('thinkingContent');
            const toggle = document.getElementById('thinkingToggle');
            content.classList.toggle('visible');
            toggle.textContent = content.classList.contains('visible') ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€';
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function addLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${type}">${message}</span>`;
            logContent.appendChild(logItem);
            logContent.scrollTop = logContent.scrollHeight;
        }

        function showError(message) {
            const toast = document.getElementById('errorToast');
            toast.textContent = message;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 5000);
        }

        function showSuccess(message) {
            const toast = document.getElementById('successToast');
            toast.textContent = message;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 3000);
        }

        function copyResult() {
            const text = document.getElementById('resultText').innerText;
            navigator.clipboard.writeText(text)
                .then(() => {
                    showSuccess('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    addLog('ğŸ“‹ å·²å¤åˆ¶', 'success');
                })
                .catch(() => {
                    addLog('âŒ å¤åˆ¶å¤±è´¥', 'error');
                });
        }

        // ==================== åˆå§‹åŒ– ====================
        addLog('ğŸ® å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ v3.1', 'info');
        addLog('ğŸ“Œ åŒAIï¼šGemini(éœ€VPN+æˆªå›¾) / DeepSeek(å›½å†…+æ‰‹åŠ¨)', 'info');
        addLog('ğŸ’¡ å»ºè®®ï¼šæˆªå›¾åˆ†æç”¨Geminiï¼Œæ‰‹åŠ¨è¾“å…¥ç”¨DeepSeek', 'info');
    </script>
</body>
</html>
