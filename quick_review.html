<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ | Quick Hand Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-card-hover: #22222e;
            --accent-gold: #ffd700;
            --accent-green: #00d4aa;
            --accent-red: #ff4757;
            --accent-blue: #4a9eff;
            --accent-purple: #a855f7;
            --text-primary: #f5f5f7;
            --text-secondary: #a0a0a8;
            --text-muted: #6a6a72;
            --border-color: #2a2a36;
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            --gradient-blue: linear-gradient(135deg, #4a9eff 0%, #0066cc 100%);
            --gradient-purple: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            --shadow-glow: 0 0 40px rgba(255, 215, 0, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-decoration {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }

        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 48px; margin-bottom: 10px; }
        .title {
            font-size: 32px; font-weight: 700;
            background: var(--gradient-gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 8px; }

        .main-panel {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        /* AI é€‰æ‹©å™¨ */
        .ai-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .ai-option {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .ai-option:hover { border-color: var(--accent-gold); }

        .ai-option.active.gemini {
            border-color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }

        .ai-option.active.deepseek {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.1);
        }

        .ai-option .ai-icon { font-size: 32px; margin-bottom: 10px; }
        .ai-option .ai-name { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .ai-option .ai-desc { font-size: 12px; color: var(--text-muted); }

        .ai-option.gemini .ai-name { color: var(--accent-blue); }
        .ai-option.deepseek .ai-name { color: var(--accent-purple); }

        .ai-badge {
            display: inline-block;
            padding: 2px 8px;
            font-size: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .ai-option.gemini .ai-badge {
            background: rgba(74, 158, 255, 0.2);
            color: var(--accent-blue);
        }

        .ai-option.deepseek .ai-badge {
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
        }

        /* è¾“å…¥æ¨¡å¼ */
        .input-mode-section { margin-bottom: 20px; }

        .mode-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .mode-row, .input-section, .ai-selector { 
                grid-template-columns: 1fr; 
                flex-direction: column;
            }
        }

        .mode-group {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px;
        }

        .mode-label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .mode-toggle { display: flex; gap: 8px; }

        .mode-btn {
            flex: 1;
            padding: 10px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover { border-color: var(--accent-gold); color: var(--text-primary); }

        .mode-btn.active {
            background: var(--gradient-gold);
            color: #000;
            border-color: var(--accent-gold);
            font-weight: 500;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-panel { min-height: 200px; }
        .input-panel.hidden { display: none; }

        .upload-card {
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-card:hover { border-color: var(--accent-gold); }
        .upload-card.has-image { border-style: solid; border-color: var(--accent-green); }
        .upload-card input[type="file"] { display: none; }

        .upload-icon { font-size: 40px; margin-bottom: 12px; }
        .upload-title { font-size: 16px; font-weight: 500; margin-bottom: 6px; }
        .upload-desc { font-size: 12px; color: var(--text-muted); }

        .upload-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }

        .upload-card.has-image .upload-preview { display: block; }
        .upload-card.has-image .upload-placeholder { display: none; }

        .clear-btn {
            display: none;
            position: absolute;
            top: 10px; right: 10px;
            padding: 6px 12px;
            font-size: 11px;
            color: white;
            background: var(--accent-red);
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .upload-card.has-image .clear-btn { display: block; }

        /* æ‰‹åŠ¨è¾“å…¥å¡ç‰‡ */
        .manual-input-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            height: 100%;
        }

        .manual-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--accent-gold);
            margin-bottom: 15px;
        }

        .manual-form { display: flex; flex-direction: column; gap: 12px; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-group.full { grid-column: 1 / -1; }

        .form-group label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .setting-input {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .setting-input.textarea {
            min-height: 80px;
            resize: vertical;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        /* è®¾ç½®åŒºåŸŸ */
        .settings-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--accent-gold);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .setting-item { display: flex; flex-direction: column; gap: 6px; }
        .setting-label { font-size: 12px; color: var(--text-secondary); }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: var(--accent-gold);
        }

        /* åˆ†ææŒ‰é’® */
        .analyze-btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            background: var(--gradient-gold);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .analyze-btn .spinner {
            display: none;
            width: 20px; height: 20px;
            border: 2px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .analyze-btn.loading .spinner { display: block; }
        .analyze-btn.loading .btn-text { display: none; }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ç»“æœåŒºåŸŸ */
        .result-section {
            margin-top: 30px;
            display: none;
        }

        .result-section.visible {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-ai-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .result-ai-badge.gemini {
            background: rgba(74, 158, 255, 0.2);
            color: var(--accent-blue);
        }

        .result-ai-badge.deepseek {
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
        }

        .copy-btn {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }

        .result-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .result-text {
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-primary);
        }

        .result-text h1, .result-text h2, .result-text h3 {
            color: var(--accent-gold);
            margin: 18px 0 10px 0;
        }

        .result-text h1 { font-size: 22px; }
        .result-text h2 { font-size: 18px; }
        .result-text h3 { font-size: 15px; }

        .result-text strong { color: var(--accent-green); }
        .result-text em { color: var(--text-secondary); }

        .result-text code {
            background: var(--bg-card);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-blue);
            font-size: 12px;
        }

        .result-text pre {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            border: 1px solid var(--border-color);
        }

        .result-text pre code {
            background: transparent;
            padding: 0;
            color: var(--text-secondary);
        }

        .result-text ul, .result-text ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .result-text li { margin: 6px 0; }
        .result-text hr { border: none; border-top: 1px solid var(--border-color); margin: 15px 0; }

        /* æ€è€ƒè¿‡ç¨‹å±•ç¤º */
        .thinking-section {
            margin-bottom: 20px;
            background: rgba(168, 85, 247, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 12px;
            overflow: hidden;
        }

        .thinking-header {
            padding: 12px 20px;
            background: rgba(168, 85, 247, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: var(--accent-purple);
        }

        .thinking-header:hover { background: rgba(168, 85, 247, 0.15); }

        .thinking-content {
            padding: 20px;
            display: none;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.7;
            max-height: 400px;
            overflow-y: auto;
        }

        .thinking-content.visible { display: block; }

        /* æ—¥å¿— */
        .log-section {
            margin-top: 25px;
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-title {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .log-content {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        .log-item {
            padding: 3px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .log-item:last-child { border-bottom: none; }
        .log-time { color: var(--text-muted); margin-right: 8px; }
        .log-success { color: var(--accent-green); }
        .log-error { color: var(--accent-red); }
        .log-info { color: var(--accent-blue); }

        /* Toast */
        .error-toast {
            position: fixed;
            top: 20px; right: 20px;
            background: var(--accent-red);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            z-index: 1000;
            display: none;
        }

        .error-toast.visible { display: block; }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
        }

        .footer a { color: var(--accent-gold); text-decoration: none; }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="error-toast" id="errorToast"></div>

    <div class="container">
        <header class="header">
            <div class="logo">ğŸƒ</div>
            <h1 class="title">å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜</h1>
            <p class="subtitle">åŒAIå¼•æ“ Â· Gemini + DeepSeekæ·±åº¦æ€è€ƒ Â· æ”¯æŒæˆªå›¾/æ‰‹åŠ¨è¾“å…¥</p>
        </header>

        <main class="main-panel">
            <!-- AI é€‰æ‹©å™¨ -->
            <div class="ai-selector">
                <div class="ai-option gemini active" onclick="selectAI('gemini')">
                    <div class="ai-icon">ğŸŒ</div>
                    <div class="ai-name">Google Gemini</div>
                    <div class="ai-desc">å¼ºå¤§çš„å¤šæ¨¡æ€AIï¼Œå›¾åƒè¯†åˆ«ç²¾å‡†</div>
                    <div class="ai-badge">éœ€è¦VPN</div>
                </div>
                <div class="ai-option deepseek" onclick="selectAI('deepseek')">
                    <div class="ai-icon">ğŸ§ </div>
                    <div class="ai-name">DeepSeek R1</div>
                    <div class="ai-desc">æ·±åº¦æ€è€ƒæ¨¡å¼ï¼Œæ¨ç†èƒ½åŠ›å¼º</div>
                    <div class="ai-badge">å›½å†…å¯ç”¨</div>
                </div>
            </div>

            <!-- è¾“å…¥æ¨¡å¼é€‰æ‹© -->
            <div class="input-mode-section">
                <div class="mode-row">
                    <div class="mode-group">
                        <label class="mode-label">ğŸ“‹ æ‰‹ç‰Œä¿¡æ¯</label>
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="hand-image" onclick="switchMode('hand', 'image')">ğŸ“· æˆªå›¾</button>
                            <button class="mode-btn" data-mode="hand-manual" onclick="switchMode('hand', 'manual')">âŒ¨ï¸ æ‰‹åŠ¨</button>
                        </div>
                    </div>
                    <div class="mode-group">
                        <label class="mode-label">ğŸ“Š å¯¹æ‰‹æ•°æ®</label>
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="opponent-image" onclick="switchMode('opponent', 'image')">ğŸ“· æˆªå›¾</button>
                            <button class="mode-btn" data-mode="opponent-manual" onclick="switchMode('opponent', 'manual')">âŒ¨ï¸ æ‰‹åŠ¨</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <!-- æ‰‹ç‰Œæˆªå›¾ -->
                <div class="input-panel" id="handImagePanel">
                    <div class="upload-card" id="handCard" onclick="triggerUpload('hand', event)">
                        <input type="file" id="handInput" accept="image/*" onchange="handleImageUpload(this, 'hand')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ´</div>
                            <div class="upload-title">ä¸Šä¼ æ‰‹ç‰Œæˆªå›¾</div>
                            <div class="upload-desc">ç‰Œå±€å›é¡¾ç•Œé¢</div>
                        </div>
                        <img class="upload-preview" id="handPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('hand'); event.stopPropagation();">âœ• é‡æ–°ä¸Šä¼ </button>
                    </div>
                </div>

                <!-- æ‰‹ç‰Œæ‰‹åŠ¨è¾“å…¥ -->
                <div class="input-panel hidden" id="handManualPanel">
                    <div class="manual-input-card">
                        <div class="manual-title">ğŸ´ æ‰‹åŠ¨è¾“å…¥æ‰‹ç‰Œ</div>
                        <div class="manual-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ç›²æ³¨ç»“æ„</label>
                                    <input type="text" id="manualBlinds" placeholder="å¦‚: 2/4/8" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>åº•æ± å¤§å°</label>
                                    <input type="text" id="manualPot" placeholder="å¦‚: 959.3" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ä½ çš„æ‰‹ç‰Œ</label>
                                    <input type="text" id="manualMyHand" placeholder="å¦‚: AKo, KQs, JJ" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>ä½ çš„ä½ç½®</label>
                                    <select id="manualPosition" class="setting-input">
                                        <option value="">é€‰æ‹©ä½ç½®</option>
                                        <option value="SB">å°ç›² (SB)</option>
                                        <option value="BB">å¤§ç›² (BB)</option>
                                        <option value="Straddle">Straddle</option>
                                        <option value="UTG">æªå£ (UTG)</option>
                                        <option value="MP">ä¸­ä½ (MP)</option>
                                        <option value="CO">å…³ç… (CO)</option>
                                        <option value="BTN">æŒ‰é’® (BTN)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group full">
                                <label>å…¬å…±ç‰Œ</label>
                                <input type="text" id="manualBoard" placeholder="å¦‚: Jc Qc 7c 5s 5h" class="setting-input">
                            </div>
                            <div class="form-group full">
                                <label>å¯¹æ‰‹æ‰‹ç‰Œï¼ˆå¦‚å·²çŸ¥ï¼‰</label>
                                <input type="text" id="manualVillainHand" placeholder="å¦‚: JJ" class="setting-input">
                            </div>
                            <div class="form-group full">
                                <label>è¡ŒåŠ¨è®°å½•</label>
                                <textarea id="manualAction" class="setting-input textarea" placeholder="ç¿»å‰: Hero COåŠ æ³¨24, Villain 3bet80, Hero call
ç¿»ç‰Œ: Hero check, Villain bet 60, Hero call
..."></textarea>
                            </div>
                            <div class="form-group full">
                                <label>ç»“æœ</label>
                                <input type="text" id="manualResult" placeholder="å¦‚: è¾“438.5" class="setting-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¯¹æ‰‹æˆªå›¾ -->
                <div class="input-panel" id="opponentImagePanel">
                    <div class="upload-card" id="opponentCard" onclick="triggerUpload('opponent', event)">
                        <input type="file" id="opponentInput" accept="image/*" onchange="handleImageUpload(this, 'opponent')">
                        <div class="upload-placeholder">
                            <div class="upload-icon">ğŸ‘¤</div>
                            <div class="upload-title">ä¸Šä¼ å¯¹æ‰‹æ•°æ®</div>
                            <div class="upload-desc">å¯¹æ‰‹é¢æ¿æˆªå›¾</div>
                        </div>
                        <img class="upload-preview" id="opponentPreview" alt="é¢„è§ˆ">
                        <button class="clear-btn" onclick="clearImage('opponent'); event.stopPropagation();">âœ• é‡æ–°ä¸Šä¼ </button>
                    </div>
                </div>

                <!-- å¯¹æ‰‹æ‰‹åŠ¨è¾“å…¥ -->
                <div class="input-panel hidden" id="opponentManualPanel">
                    <div class="manual-input-card">
                        <div class="manual-title">ğŸ‘¤ æ‰‹åŠ¨è¾“å…¥å¯¹æ‰‹æ•°æ®</div>
                        <div class="manual-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å¯¹æ‰‹æ˜µç§°</label>
                                    <input type="text" id="manualVillainName" placeholder="å¦‚: xiaolv" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>æ‰‹æ•°</label>
                                    <input type="text" id="manualVillainHands" placeholder="å¦‚: 8446" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å…¥å±€ç‡ VPIP (%)</label>
                                    <input type="text" id="manualVillainVPIP" placeholder="å¦‚: 45" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>èƒœç‡ (%)</label>
                                    <input type="text" id="manualVillainWinRate" placeholder="å¦‚: 20" class="setting-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>æ‘Šç‰Œç‡ (%)</label>
                                    <input type="text" id="manualVillainShowdown" placeholder="å¦‚: 13" class="setting-input">
                                </div>
                                <div class="form-group">
                                    <label>å¤‡æ³¨</label>
                                    <input type="text" id="manualVillainNotes" placeholder="å¦‚: çˆ±è¯ˆå”¬" class="setting-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½® -->
            <div class="settings-section">
                <div class="settings-title">âš™ï¸ åˆ†æè®¾ç½®</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">ä½ çš„æ˜µç§°</label>
                        <input type="text" class="setting-input" id="username" value="luckywm">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">ç­¹ç æ·±åº¦ (BB)</label>
                        <input type="text" class="setting-input" id="stackDepth" placeholder="é»˜è®¤: 200-300">
                    </div>
                    <div class="setting-item">
                        <label class="checkbox-item">
                            <input type="checkbox" id="isShortStack" onchange="toggleShortStack()">
                            <span>å¯¹æ‰‹æ˜¯çŸ­ç </span>
                        </label>
                    </div>
                    <div class="setting-item" id="shortStackInput" style="display: none;">
                        <label class="setting-label">å¯¹æ‰‹ç­¹ç  (BB)</label>
                        <input type="text" class="setting-input" id="opponentStack" placeholder="å¦‚: 50">
                    </div>
                </div>
            </div>

            <!-- åˆ†ææŒ‰é’® -->
            <button class="analyze-btn" id="analyzeBtn" onclick="analyzeHand()">
                <span class="spinner"></span>
                <span class="btn-text">ğŸš€ å¼€å§‹AIå¤ç›˜åˆ†æ</span>
            </button>

            <!-- ç»“æœåŒºåŸŸ -->
            <section class="result-section" id="resultSection">
                <div class="result-header">
                    <h2 class="result-title">
                        <span>ğŸ“Š</span>
                        <span>åˆ†æç»“æœ</span>
                        <span class="result-ai-badge" id="resultAiBadge"></span>
                    </h2>
                    <button class="copy-btn" onclick="copyResult()">ğŸ“‹ å¤åˆ¶</button>
                </div>
                
                <!-- DeepSeekæ€è€ƒè¿‡ç¨‹ -->
                <div class="thinking-section" id="thinkingSection" style="display: none;">
                    <div class="thinking-header" onclick="toggleThinking()">
                        <span>ğŸ§  DeepSeek æ€è€ƒè¿‡ç¨‹</span>
                        <span id="thinkingToggle">â–¼ å±•å¼€</span>
                    </div>
                    <div class="thinking-content" id="thinkingContent"></div>
                </div>
                
                <div class="result-content">
                    <div class="result-text" id="resultText"></div>
                </div>
            </section>

            <!-- æ—¥å¿— -->
            <div class="log-section">
                <div class="log-title">ğŸ“ è¿è¡Œæ—¥å¿—</div>
                <div class="log-content" id="logContent">
                    <div class="log-item">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span class="log-info">å·¥å…·å·²å°±ç»ª</span>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>åŒAIå¼•æ“ï¼šGemini + DeepSeek Â· <a href="index.html">è¿”å›ä¸»é¡µ</a></p>
        </footer>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const CONFIG = {
            GEMINI_API_KEY: 'AIzaSyCGLHoZLcXU7oQiKXT9929PZwal1UenRjY',
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
            DEEPSEEK_API_KEY: 'sk-e4f2758c58d14807bc9004539ffbb0e8',
            DEEPSEEK_API_URL: 'https://api.deepseek.com/chat/completions',
            DEFAULT_USERNAME: 'luckywm',
            DEFAULT_STACK_DEPTH: '200-300'
        };

        // çŠ¶æ€
        let selectedAI = 'gemini';
        let uploadedImages = { hand: null, opponent: null };
        let inputModes = { hand: 'image', opponent: 'image' };

        // ==================== AI é€‰æ‹© ====================
        function selectAI(ai) {
            selectedAI = ai;
            document.querySelectorAll('.ai-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`.ai-option.${ai}`).classList.add('active');
            addLog(`ğŸ¤– åˆ‡æ¢åˆ° ${ai === 'gemini' ? 'Google Gemini' : 'DeepSeek R1 æ·±åº¦æ€è€ƒ'}`, 'info');
        }

        // ==================== æ¨¡å¼åˆ‡æ¢ ====================
        function switchMode(type, mode) {
            inputModes[type] = mode;
            document.querySelectorAll(`.mode-btn[data-mode^="${type}-"]`).forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === `${type}-${mode}`);
            });
            document.getElementById(`${type}ImagePanel`).classList.toggle('hidden', mode !== 'image');
            document.getElementById(`${type}ManualPanel`).classList.toggle('hidden', mode !== 'manual');
        }

        function toggleShortStack() {
            document.getElementById('shortStackInput').style.display = 
                document.getElementById('isShortStack').checked ? 'block' : 'none';
        }

        // ==================== å›¾ç‰‡å¤„ç† ====================
        function triggerUpload(type, event) {
            if (event.target.classList.contains('clear-btn')) return;
            document.getElementById(`${type}Input`).click();
        }

        function handleImageUpload(input, type) {
            const file = input.files[0];
            if (!file) return;
            if (file.size > 10 * 1024 * 1024) {
                showError('å›¾ç‰‡å¤ªå¤§ï¼Œæœ€å¤§10MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                compressImage(e.target.result, function(data) {
                    uploadedImages[type] = data;
                    document.getElementById(`${type}Preview`).src = data;
                    document.getElementById(`${type}Card`).classList.add('has-image');
                    addLog(`âœ… ${type === 'hand' ? 'æ‰‹ç‰Œ' : 'å¯¹æ‰‹'}æˆªå›¾å·²ä¸Šä¼ `, 'success');
                });
            };
            reader.readAsDataURL(file);
        }

        function compressImage(dataUrl, callback) {
            const img = new Image();
            img.onload = function() {
                const maxDim = 1536;
                let w = img.width, h = img.height;
                if (w > maxDim || h > maxDim) {
                    const ratio = Math.min(maxDim / w, maxDim / h);
                    w = Math.round(w * ratio);
                    h = Math.round(h * ratio);
                    const canvas = document.createElement('canvas');
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.85));
                } else {
                    callback(dataUrl);
                }
            };
            img.src = dataUrl;
        }

        function clearImage(type) {
            uploadedImages[type] = null;
            document.getElementById(`${type}Preview`).src = '';
            document.getElementById(`${type}Card`).classList.remove('has-image');
            document.getElementById(`${type}Input`).value = '';
        }

        // ==================== æ•°æ®æ”¶é›† ====================
        function collectManualHandData() {
            return {
                blinds: document.getElementById('manualBlinds').value.trim(),
                pot: document.getElementById('manualPot').value.trim(),
                myHand: document.getElementById('manualMyHand').value.trim(),
                position: document.getElementById('manualPosition').value,
                board: document.getElementById('manualBoard').value.trim(),
                villainHand: document.getElementById('manualVillainHand').value.trim(),
                action: document.getElementById('manualAction').value.trim(),
                result: document.getElementById('manualResult').value.trim()
            };
        }

        function collectManualOpponentData() {
            return {
                name: document.getElementById('manualVillainName').value.trim(),
                hands: document.getElementById('manualVillainHands').value.trim(),
                vpip: document.getElementById('manualVillainVPIP').value.trim(),
                winRate: document.getElementById('manualVillainWinRate').value.trim(),
                showdown: document.getElementById('manualVillainShowdown').value.trim(),
                notes: document.getElementById('manualVillainNotes').value.trim()
            };
        }

        function formatManualData(handData, opponentData) {
            let text = '';
            if (handData) {
                text += 'ã€æ‰‹ç‰Œä¿¡æ¯ã€‘\n';
                if (handData.blinds) text += `ç›²æ³¨: ${handData.blinds}\n`;
                if (handData.pot) text += `åº•æ± : ${handData.pot}\n`;
                if (handData.myHand) text += `æˆ‘çš„æ‰‹ç‰Œ: ${handData.myHand}\n`;
                if (handData.position) text += `æˆ‘çš„ä½ç½®: ${handData.position}\n`;
                if (handData.board) text += `å…¬å…±ç‰Œ: ${handData.board}\n`;
                if (handData.villainHand) text += `å¯¹æ‰‹æ‰‹ç‰Œ: ${handData.villainHand}\n`;
                if (handData.action) text += `è¡ŒåŠ¨:\n${handData.action}\n`;
                if (handData.result) text += `ç»“æœ: ${handData.result}\n`;
            }
            if (opponentData) {
                text += '\nã€å¯¹æ‰‹æ•°æ®ã€‘\n';
                if (opponentData.name) text += `æ˜µç§°: ${opponentData.name}\n`;
                if (opponentData.hands) text += `æ‰‹æ•°: ${opponentData.hands}\n`;
                if (opponentData.vpip) text += `å…¥å±€ç‡: ${opponentData.vpip}%\n`;
                if (opponentData.winRate) text += `èƒœç‡: ${opponentData.winRate}%\n`;
                if (opponentData.showdown) text += `æ‘Šç‰Œç‡: ${opponentData.showdown}%\n`;
                if (opponentData.notes) text += `å¤‡æ³¨: ${opponentData.notes}\n`;
            }
            return text;
        }

        // ==================== æ„å»ºæç¤ºè¯ ====================
        function buildPrompt(manualText) {
            const username = document.getElementById('username').value || CONFIG.DEFAULT_USERNAME;
            const stackDepth = document.getElementById('stackDepth').value || CONFIG.DEFAULT_STACK_DEPTH;
            
            let inputDesc = '';
            if (inputModes.hand === 'image' && inputModes.opponent === 'image') {
                inputDesc = 'è¯·ä»ä¸¤å¼ æˆªå›¾ä¸­è¯†åˆ«ä¿¡æ¯ï¼šç¬¬ä¸€å¼ æ˜¯ç‰Œå±€å›é¡¾ï¼Œç¬¬äºŒå¼ æ˜¯å¯¹æ‰‹æ•°æ®é¢æ¿ã€‚';
            } else if (inputModes.hand === 'manual' && inputModes.opponent === 'manual') {
                inputDesc = `ç”¨æˆ·å·²æ‰‹åŠ¨è¾“å…¥æ‰€æœ‰ä¿¡æ¯ï¼Œè¯·ç›´æ¥ä½¿ç”¨ï¼š\n\n${manualText}`;
            } else if (inputModes.hand === 'image') {
                inputDesc = `è¯·ä»æˆªå›¾è¯†åˆ«æ‰‹ç‰Œä¿¡æ¯ï¼Œå¯¹æ‰‹æ•°æ®ç”±ç”¨æˆ·æä¾›ï¼š\n\n${manualText}`;
            } else {
                inputDesc = `æ‰‹ç‰Œä¿¡æ¯ç”±ç”¨æˆ·æä¾›ï¼Œè¯·ä»æˆªå›¾è¯†åˆ«å¯¹æ‰‹æ•°æ®ï¼š\n\n${manualText}`;
            }

            return `ä½ æ˜¯ä¸–ç•Œé¡¶çº§å¾·å·æ‰‘å…‹èŒä¸šé€‰æ‰‹å’Œæ•™ç»ƒï¼Œ20å¹´é«˜çº§åˆ«ç°é‡‘å±€ç»éªŒã€‚å¸®åŠ©ç©å®¶${username}å¤ç›˜æ‰‹ç‰Œã€‚

## åŸºæœ¬ä¿¡æ¯
- ç©å®¶æ˜µç§°: ${username}
- ç­¹ç æ·±åº¦: ${stackDepth} BB
- æ¸¸æˆç±»å‹: æœ‰Straddleçš„ç°é‡‘å±€

## è¾“å…¥æ•°æ®
${inputDesc}

## åˆ†æè¦æ±‚

### 1ï¸âƒ£ ä¿¡æ¯ç¡®è®¤
åˆ—å‡ºè¯†åˆ«/è¾“å…¥çš„å…³é”®ä¿¡æ¯ï¼šç›²æ³¨ã€åº•æ± ã€æ‰‹ç‰Œã€ä½ç½®ã€å…¬å…±ç‰Œã€å¯¹æ‰‹æ•°æ®

### 2ï¸âƒ£ å¯¹æ‰‹ç±»å‹
æ ¹æ®VPIP/æ‘Šç‰Œç‡åˆ¤æ–­ï¼šæ¾å‡¶LAG/æ¾è¢«åŠ¨LP/ç´§å‡¶TAG/ç´§è¢«åŠ¨TP/é±¼

### 3ï¸âƒ£ é€è¡—åˆ†æ
- **ç¿»å‰**: èµ·æ‰‹ç‰Œå¼ºåº¦ã€ä½ç½®ã€è¡ŒåŠ¨æ˜¯å¦æ­£ç¡®
- **ç¿»ç‰Œ**: ç‰Œé¢ç»“æ„ã€èŒƒå›´ä¼˜åŠ¿ã€è¡ŒåŠ¨é€‰æ‹©
- **è½¬ç‰Œ**: ç‰ŒåŠ›å˜åŒ–ã€SPRã€æ˜¯å¦ç»§ç»­
- **æ²³ç‰Œ**: å¬ç‰Œå®Œæˆæƒ…å†µã€ä»·å€¼/è¯ˆå”¬é€‰æ‹©

### 4ï¸âƒ£ å…³é”®å†³ç­–EVè¯„ä¼°
æŒ‡å‡º1-2ä¸ªå…³é”®å†³ç­–ç‚¹ï¼Œè¯„ä¼°EV

### 5ï¸âƒ£ æ€»ç»“
- è¯„ä»·: ä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/éœ€æ”¹è¿›
- ä¸»è¦é—®é¢˜
- æ”¹è¿›å»ºè®®
- è¯„åˆ†: X/10

è¯·å¼€å§‹åˆ†æï¼š`;
        }

        // ==================== éªŒè¯è¾“å…¥ ====================
        function validateInput() {
            if (inputModes.hand === 'image' && !uploadedImages.hand) {
                showError('è¯·ä¸Šä¼ æ‰‹ç‰Œæˆªå›¾æˆ–åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥');
                return false;
            }
            if (inputModes.hand === 'manual' && !document.getElementById('manualMyHand').value.trim()) {
                showError('è¯·è¾“å…¥ä½ çš„æ‰‹ç‰Œ');
                return false;
            }
            if (inputModes.opponent === 'image' && !uploadedImages.opponent) {
                showError('è¯·ä¸Šä¼ å¯¹æ‰‹æ•°æ®æˆªå›¾æˆ–åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥');
                return false;
            }
            if (inputModes.opponent === 'manual') {
                const vpip = document.getElementById('manualVillainVPIP').value.trim();
                if (!vpip) {
                    showError('è¯·è‡³å°‘è¾“å…¥å¯¹æ‰‹å…¥å±€ç‡');
                    return false;
                }
            }
            return true;
        }

        // ==================== è°ƒç”¨ Gemini API ====================
        async function callGemini(prompt) {
            const parts = [{ text: prompt }];
            
            if (inputModes.hand === 'image' && uploadedImages.hand) {
                const [header, data] = uploadedImages.hand.split(',');
                const mimeType = header.match(/:(.*?);/)[1];
                parts.push({ inline_data: { mime_type: mimeType, data: data } });
            }
            
            if (inputModes.opponent === 'image' && uploadedImages.opponent) {
                const [header, data] = uploadedImages.opponent.split(',');
                const mimeType = header.match(/:(.*?);/)[1];
                parts.push({ inline_data: { mime_type: mimeType, data: data } });
            }

            const response = await fetch(`${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts }],
                    generationConfig: { temperature: 0.7, maxOutputTokens: 8192 }
                })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || `Geminié”™è¯¯: ${response.status}`);
            }

            const data = await response.json();
            return {
                text: data.candidates?.[0]?.content?.parts?.[0]?.text || '',
                thinking: null
            };
        }

        // ==================== è°ƒç”¨ DeepSeek API ====================
        async function callDeepSeek(prompt) {
            // DeepSeekä¸æ”¯æŒå›¾ç‰‡ï¼Œéœ€è¦æŠŠå›¾ç‰‡ä¿¡æ¯è½¬ä¸ºæ–‡æœ¬æè¿°
            let fullPrompt = prompt;
            if (inputModes.hand === 'image') {
                fullPrompt += '\n\næ³¨æ„ï¼šç”¨æˆ·ä¸Šä¼ äº†æ‰‹ç‰Œæˆªå›¾ï¼Œä½†ä½ æ— æ³•æŸ¥çœ‹å›¾ç‰‡ã€‚è¯·æç¤ºç”¨æˆ·åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ï¼Œæˆ–è€…ç”¨æˆ·å¯ä»¥å£è¿°æˆªå›¾å†…å®¹ã€‚';
            }
            if (inputModes.opponent === 'image') {
                fullPrompt += '\n\næ³¨æ„ï¼šç”¨æˆ·ä¸Šä¼ äº†å¯¹æ‰‹æ•°æ®æˆªå›¾ï¼Œä½†ä½ æ— æ³•æŸ¥çœ‹å›¾ç‰‡ã€‚è¯·æç¤ºç”¨æˆ·åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ã€‚';
            }

            const response = await fetch(CONFIG.DEEPSEEK_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${CONFIG.DEEPSEEK_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'deepseek-reasoner',
                    messages: [{ role: 'user', content: fullPrompt }],
                    max_tokens: 8192
                })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || `DeepSeeké”™è¯¯: ${response.status}`);
            }

            const data = await response.json();
            const choice = data.choices?.[0];
            return {
                text: choice?.message?.content || '',
                thinking: choice?.message?.reasoning_content || null
            };
        }

        // ==================== ä¸»åˆ†æå‡½æ•° ====================
        async function analyzeHand() {
            if (!validateInput()) return;

            const btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            btn.classList.add('loading');

            addLog(`ğŸš€ å¼€å§‹åˆ†æ (${selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1'})...`, 'info');

            try {
                // æ”¶é›†æ‰‹åŠ¨è¾“å…¥æ•°æ®
                const handData = inputModes.hand === 'manual' ? collectManualHandData() : null;
                const opponentData = inputModes.opponent === 'manual' ? collectManualOpponentData() : null;
                const manualText = formatManualData(handData, opponentData);

                const prompt = buildPrompt(manualText);
                
                addLog('â³ AIåˆ†æä¸­ï¼Œè¯·ç¨å€™...', 'info');

                let result;
                if (selectedAI === 'gemini') {
                    result = await callGemini(prompt);
                } else {
                    result = await callDeepSeek(prompt);
                }

                addLog('âœ… åˆ†æå®Œæˆï¼', 'success');
                displayResult(result.text, result.thinking);

            } catch (error) {
                console.error('Error:', error);
                let msg = error.message;
                if (msg.includes('Failed to fetch')) {
                    msg = selectedAI === 'gemini' ? 'æ— æ³•è¿æ¥Geminiï¼Œè¯·æ£€æŸ¥VPN' : 'æ— æ³•è¿æ¥DeepSeek';
                }
                showError(msg);
                addLog(`âŒ ${msg}`, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }

        // ==================== æ˜¾ç¤ºç»“æœ ====================
        function displayResult(text, thinking) {
            const resultSection = document.getElementById('resultSection');
            const resultText = document.getElementById('resultText');
            const badge = document.getElementById('resultAiBadge');
            const thinkingSection = document.getElementById('thinkingSection');
            
            // AIæ ‡è®°
            badge.textContent = selectedAI === 'gemini' ? 'Gemini' : 'DeepSeek R1';
            badge.className = `result-ai-badge ${selectedAI}`;
            
            // æ€è€ƒè¿‡ç¨‹ï¼ˆDeepSeekï¼‰
            if (thinking) {
                thinkingSection.style.display = 'block';
                document.getElementById('thinkingContent').textContent = thinking;
            } else {
                thinkingSection.style.display = 'none';
            }

            // æ¸²æŸ“Markdown
            let html = text
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/(?<!\*)\*([^*]+)\*(?!\*)/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/^---$/gim, '<hr>')
                .replace(/^[\-\*] (.*)$/gim, '<li>$1</li>')
                .replace(/^\d+\. (.*)$/gim, '<li>$1</li>');

            html = html.replace(/(<li>[\s\S]*?<\/li>)+/g, '<ul>$&</ul>');
            html = html.replace(/\n/g, '<br>');
            html = html.replace(/<br>\s*<br>/g, '<br>');
            html = html.replace(/<\/(h[123]|li|ul|hr|pre)><br>/g, '</$1>');

            resultText.innerHTML = html;
            resultSection.classList.add('visible');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleThinking() {
            const content = document.getElementById('thinkingContent');
            const toggle = document.getElementById('thinkingToggle');
            content.classList.toggle('visible');
            toggle.textContent = content.classList.contains('visible') ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€';
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function addLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${type}">${message}</span>`;
            logContent.appendChild(logItem);
            logContent.scrollTop = logContent.scrollHeight;
        }

        function showError(message) {
            const toast = document.getElementById('errorToast');
            toast.textContent = message;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 5000);
        }

        function copyResult() {
            navigator.clipboard.writeText(document.getElementById('resultText').innerText)
                .then(() => addLog('ğŸ“‹ å·²å¤åˆ¶', 'success'))
                .catch(() => addLog('âŒ å¤åˆ¶å¤±è´¥', 'error'));
        }

        // ==================== åˆå§‹åŒ– ====================
        addLog('ğŸ® å¾·å·æ‰‘å…‹å¿«é€Ÿå¤ç›˜ v3.0', 'info');
        addLog('ğŸ“Œ åŒAIå¼•æ“ï¼šGemini(éœ€VPN) + DeepSeek(å›½å†…å¯ç”¨)', 'info');
    </script>
</body>
</html>
