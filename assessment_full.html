<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¯ å¾·å·æ‰‘å…‹å…¨é¢æ¼æ´è¯Šæ–­ - 55é¢˜æ·±åº¦è¯„ä¼°</title>
    <link rel="manifest" href="assessment_manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0d0d1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --accent-red: #e74c3c;
            --accent-green: #2ecc71;
            --accent-blue: #3498db;
            --accent-gold: #f39c12;
            --accent-purple: #9b59b6;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-danger: linear-gradient(135deg, #f12711 0%, #f5af19 100%);
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: var(--bg-secondary);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--accent-purple);
        }
        
        .header h1 {
            font-size: 1.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            color: var(--text-secondary);
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        /* è¿›åº¦æ¡åŒºåŸŸ */
        .progress-section {
            background: var(--bg-secondary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--bg-card);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .category-indicator {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .category-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: var(--bg-card);
            color: var(--text-secondary);
        }
        
        .category-badge.active {
            background: var(--gradient-primary);
            color: white;
        }
        
        .category-badge.complete {
            background: var(--gradient-success);
            color: white;
        }
        
        /* å¼€å§‹é¡µé¢ */
        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .welcome-screen h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .assessment-info {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
        }
        
        .info-item .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .dimensions-list {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .dimensions-list h4 {
            color: var(--accent-blue);
            margin-bottom: 10px;
        }
        
        .dimension-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--bg-secondary);
        }
        
        .dimension-row:last-child {
            border-bottom: none;
        }
        
        .dimension-count {
            color: var(--accent-gold);
            font-weight: bold;
        }
        
        .start-btn {
            background: var(--gradient-primary);
            border: none;
            color: white;
            padding: 18px 50px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        /* é—®é¢˜å¡ç‰‡ */
        .question-screen {
            display: none;
        }
        
        .question-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .question-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .meta-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .meta-badge.category {
            background: var(--gradient-primary);
            color: white;
        }
        
        .meta-badge.subcategory {
            background: var(--bg-card);
            color: var(--accent-blue);
        }
        
        .scenario {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-purple);
        }
        
        .scenario-label {
            color: var(--accent-purple);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .question-text {
            font-size: 1.1rem;
            color: var(--accent-gold);
            margin: 15px 0;
            font-weight: 500;
        }
        
        .options-grid {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }
        
        .option-btn {
            background: var(--bg-card);
            border: 2px solid transparent;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        .option-btn:hover {
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            border-color: var(--accent-blue);
            background: rgba(52, 152, 219, 0.2);
        }
        
        .option-btn.correct {
            border-color: var(--accent-green);
            background: rgba(46, 204, 113, 0.2);
        }
        
        .option-btn.wrong {
            border-color: var(--accent-red);
            background: rgba(231, 76, 60, 0.2);
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* è§£é‡ŠåŒºåŸŸ */
        .explanation-area {
            display: none;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-green);
        }
        
        .explanation-area.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .explanation-area h4 {
            color: var(--accent-green);
            margin-bottom: 15px;
        }
        
        .explanation-area pre {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .leak-warning {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--accent-red);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        
        .leak-warning h5 {
            color: var(--accent-red);
            margin-bottom: 5px;
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-btn.prev {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        .nav-btn.next {
            background: var(--gradient-primary);
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ç»“æœé¡µé¢ */
        .result-screen {
            display: none;
            padding: 20px 0;
        }
        
        .result-header {
            text-align: center;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .score-circle.excellent {
            background: var(--gradient-success);
        }
        
        .score-circle.good {
            background: var(--gradient-primary);
        }
        
        .score-circle.average {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
        }
        
        .score-circle.poor {
            background: var(--gradient-danger);
        }
        
        .score-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .result-grade {
            font-size: 1.3rem;
            margin-top: 15px;
        }
        
        /* åˆ†ç±»æˆç»© */
        .category-results {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .category-results h3 {
            color: var(--accent-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bg-card);
        }
        
        .category-score-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--bg-card);
        }
        
        .category-score-row:last-child {
            border-bottom: none;
        }
        
        .category-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-icon {
            font-size: 1.2rem;
        }
        
        .category-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }
        
        .category-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .category-percent {
            font-weight: bold;
            min-width: 50px;
            text-align: right;
        }
        
        /* æ¼æ´åˆ†æ */
        .leak-analysis {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .leak-analysis h3 {
            color: var(--accent-red);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .leak-group {
            margin-bottom: 20px;
        }
        
        .leak-group h4 {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .leak-group.severe h4 {
            background: rgba(231, 76, 60, 0.3);
            color: var(--accent-red);
        }
        
        .leak-group.high h4 {
            background: rgba(243, 156, 18, 0.3);
            color: var(--accent-gold);
        }
        
        .leak-group.medium h4 {
            background: rgba(52, 152, 219, 0.3);
            color: var(--accent-blue);
        }
        
        .leak-item {
            background: var(--bg-card);
            padding: 12px 15px;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .leak-item .leak-name {
            flex: 1;
        }
        
        .leak-item .train-btn {
            background: var(--gradient-primary);
            border: none;
            color: white;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        
        /* å»ºè®®åŒºåŸŸ */
        .recommendations {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .recommendations h3 {
            color: var(--accent-green);
            margin-bottom: 15px;
        }
        
        .rec-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid var(--accent-green);
        }
        
        .rec-item .priority {
            font-size: 0.8rem;
            color: var(--accent-gold);
            margin-bottom: 5px;
        }
        
        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn.primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .action-btn.secondary {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .question-card {
                padding: 15px;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .category-score-row {
                flex-wrap: wrap;
            }
            
            .category-bar {
                width: 100%;
                margin: 10px 0;
            }
        }
        
        /* éšè—ç±» */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- è¿”å›å¯¼èˆªæŒ‰é’® -->
    <a href="index.html?v=6" style="position: fixed; top: 15px; left: 15px; background: rgba(103,126,234,0.2); border: 1px solid rgba(103,126,234,0.5); color: #667eea; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 13px; z-index: 100; transition: all 0.3s;">â† è¿”å›å¯¼èˆª</a>
    
    <div class="header">
        <h1>ğŸ¯ å¾·å·æ‰‘å…‹å…¨é¢æ¼æ´è¯Šæ–­</h1>
        <div class="subtitle">55é¢˜æ·±åº¦è¯„ä¼° | 8å¤§ç»´åº¦ | ä¸–ç•Œçº§æ ‡å‡†</div>
    </div>
    
    <div class="container">
        <!-- å¼€å§‹é¡µé¢ -->
        <div id="welcomeScreen" class="welcome-screen">
            <h2>ğŸ” å…¨æ–¹ä½æ¼æ´è¯Šæ–­</h2>
            
            <div class="assessment-info">
                <p>è¿™æ˜¯ä¸€å¥—ä¸“ä¸ºé«˜é˜¶ç©å®¶è®¾è®¡çš„æ·±åº¦è¯„ä¼°ç³»ç»Ÿã€‚é€šè¿‡55é“ç²¾å¿ƒè®¾è®¡çš„è¯Šæ–­é¢˜ï¼Œå…¨é¢æ£€æµ‹ä½ åœ¨å¾·å·æ‰‘å…‹8å¤§æ ¸å¿ƒç»´åº¦çš„æ¼æ´ã€‚</p>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="value">55</div>
                        <div class="label">è¯Šæ–­é¢˜ç›®</div>
                    </div>
                    <div class="info-item">
                        <div class="value">8</div>
                        <div class="label">æ ¸å¿ƒç»´åº¦</div>
                    </div>
                    <div class="info-item">
                        <div class="value">~30</div>
                        <div class="label">é¢„è®¡åˆ†é’Ÿ</div>
                    </div>
                    <div class="info-item">
                        <div class="value">100ä¸‡+</div>
                        <div class="label">é€‚ç”¨æ‰‹æ•°</div>
                    </div>
                </div>
                
                <div class="dimensions-list">
                    <h4>ğŸ“Š è¯„ä¼°ç»´åº¦</h4>
                    <div class="dimension-row">
                        <span>ğŸƒ ç¿»å‰å†³ç­–</span>
                        <span class="dimension-count">10é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ´ ç¿»ç‰Œå†³ç­–</span>
                        <span class="dimension-count">10é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ”„ è½¬ç‰Œå†³ç­–</span>
                        <span class="dimension-count">8é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ æ²³ç‰Œå†³ç­–</span>
                        <span class="dimension-count">8é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ“ æ•°å­¦è®¡ç®—</span>
                        <span class="dimension-count">6é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ¯ å¯¹æ‰‹åˆ†æä¸å‰¥å‰Š</span>
                        <span class="dimension-count">8é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ§  å¿ƒæ€ä¸Sessionç®¡ç†</span>
                        <span class="dimension-count">5é¢˜</span>
                    </div>
                    <div class="dimension-row">
                        <span>ğŸ“ é«˜çº§æ¦‚å¿µ</span>
                        <span class="dimension-count">5é¢˜</span>
                    </div>
                </div>
            </div>
            
            <button class="start-btn" onclick="startAssessment()">
                ğŸš€ å¼€å§‹è¯Šæ–­
            </button>
        </div>
        
        <!-- è¿›åº¦åŒºåŸŸ -->
        <div id="progressSection" class="progress-section hidden">
            <div class="progress-header">
                <span id="progressText">0 / 55</span>
                <span id="correctCount">æ­£ç¡®: 0</span>
            </div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="category-indicator" id="categoryIndicator"></div>
        </div>
        
        <!-- é—®é¢˜é¡µé¢ -->
        <div id="questionScreen" class="question-screen">
            <div class="question-card">
                <div class="question-meta">
                    <span id="categoryBadge" class="meta-badge category"></span>
                    <span id="subcategoryBadge" class="meta-badge subcategory"></span>
                </div>
                
                <div class="scenario">
                    <div class="scenario-label">ğŸ“‹ åœºæ™¯æè¿°</div>
                    <div id="scenarioText"></div>
                </div>
                
                <div id="questionText" class="question-text"></div>
                
                <div id="optionsGrid" class="options-grid"></div>
                
                <div id="explanationArea" class="explanation-area">
                    <h4>ğŸ’¡ æ­£ç¡®ç­”æ¡ˆä¸è§£æ</h4>
                    <pre id="explanationText"></pre>
                    <div id="leakWarning" class="leak-warning hidden">
                        <h5>âš ï¸ æ£€æµ‹åˆ°æ¼æ´</h5>
                        <p id="leakDesc"></p>
                    </div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button id="prevBtn" class="nav-btn prev" onclick="prevQuestion()">
                    â† ä¸Šä¸€é¢˜
                </button>
                <button id="nextBtn" class="nav-btn next" onclick="nextQuestion()">
                    ä¸‹ä¸€é¢˜ â†’
                </button>
            </div>
        </div>
        
        <!-- ç»“æœé¡µé¢ -->
        <div id="resultScreen" class="result-screen">
            <div class="result-header">
                <div id="scoreCircle" class="score-circle">
                    <span id="scoreValue">0%</span>
                    <span class="score-label">æ€»åˆ†</span>
                </div>
                <div id="resultGrade" class="result-grade"></div>
            </div>
            
            <div class="category-results">
                <h3>ğŸ“Š å„ç»´åº¦æˆç»©</h3>
                <div id="categoryScores"></div>
            </div>
            
            <div id="leakAnalysis" class="leak-analysis">
                <h3>ğŸš¨ æ¼æ´åˆ†æ</h3>
                <div id="leakGroups"></div>
            </div>
            
            <div class="recommendations">
                <h3>ğŸ’¡ è®­ç»ƒå»ºè®®</h3>
                <div id="recList"></div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn primary" onclick="restartAssessment()">
                    ğŸ”„ é‡æ–°è¯Šæ–­
                </button>
                <button class="action-btn secondary" onclick="exportResults()">
                    ğŸ“¤ å¯¼å‡ºæŠ¥å‘Š
                </button>
                <button class="action-btn secondary" onclick="goToTraining()">
                    ğŸ“š å¼€å§‹è®­ç»ƒ
                </button>
            </div>
        </div>
    </div>
    
    <script src="assessment_full.js"></script>
    <script>
        // å…¨å±€çŠ¶æ€
        let currentQuestionIndex = 0;
        let answers = {};
        let leaksDetected = [];
        let allQuestions = [];
        let categoryStats = {};
        
        // ç±»åˆ«é…ç½®
        const CATEGORY_CONFIG = {
            preflop: { name: 'ç¿»å‰å†³ç­–', icon: 'ğŸƒ', color: '#e74c3c' },
            flop: { name: 'ç¿»ç‰Œå†³ç­–', icon: 'ğŸ´', color: '#f39c12' },
            turn: { name: 'è½¬ç‰Œå†³ç­–', icon: 'ğŸ”„', color: '#2ecc71' },
            river: { name: 'æ²³ç‰Œå†³ç­–', icon: 'ğŸ', color: '#3498db' },
            math: { name: 'æ•°å­¦è®¡ç®—', icon: 'ğŸ“', color: '#9b59b6' },
            exploit: { name: 'å¯¹æ‰‹åˆ†æ', icon: 'ğŸ¯', color: '#1abc9c' },
            mental: { name: 'å¿ƒæ€ç®¡ç†', icon: 'ğŸ§ ', color: '#e91e63' },
            advanced: { name: 'é«˜çº§æ¦‚å¿µ', icon: 'ğŸ“', color: '#ff9800' }
        };
        
        // åˆå§‹åŒ–æ‰€æœ‰é—®é¢˜
        function initQuestions() {
            allQuestions = [];
            categoryStats = {};
            
            for (const [category, questions] of Object.entries(FULL_ASSESSMENT)) {
                categoryStats[category] = {
                    total: questions.length,
                    correct: 0
                };
                questions.forEach(q => {
                    allQuestions.push({
                        ...q,
                        categoryKey: category
                    });
                });
            }
        }
        
        // å¼€å§‹è¯„ä¼°
        function startAssessment() {
            initQuestions();
            currentQuestionIndex = 0;
            answers = {};
            leaksDetected = [];
            
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('progressSection').classList.remove('hidden');
            document.getElementById('questionScreen').style.display = 'block';
            document.getElementById('resultScreen').style.display = 'none';
            
            renderCategoryIndicator();
            renderQuestion();
        }
        
        // æ¸²æŸ“ç±»åˆ«æŒ‡ç¤ºå™¨
        function renderCategoryIndicator() {
            const container = document.getElementById('categoryIndicator');
            container.innerHTML = '';
            
            let currentIndex = 0;
            for (const [key, config] of Object.entries(CATEGORY_CONFIG)) {
                const count = FULL_ASSESSMENT[key].length;
                const badge = document.createElement('span');
                badge.className = 'category-badge';
                badge.id = `cat-badge-${key}`;
                badge.textContent = `${config.icon} ${config.name}`;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç±»åˆ«
                if (currentQuestionIndex >= currentIndex && currentQuestionIndex < currentIndex + count) {
                    badge.classList.add('active');
                }
                // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ
                else if (currentQuestionIndex >= currentIndex + count) {
                    badge.classList.add('complete');
                }
                
                container.appendChild(badge);
                currentIndex += count;
            }
        }
        
        // æ¸²æŸ“å½“å‰é—®é¢˜
        function renderQuestion() {
            const q = allQuestions[currentQuestionIndex];
            const config = CATEGORY_CONFIG[q.categoryKey];
            
            document.getElementById('categoryBadge').textContent = `${config.icon} ${config.name}`;
            document.getElementById('subcategoryBadge').textContent = q.subcategory;
            document.getElementById('scenarioText').textContent = q.scenario;
            document.getElementById('questionText').textContent = q.question;
            
            // æ¸²æŸ“é€‰é¡¹
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = `${String.fromCharCode(65 + idx)}. ${opt}`;
                btn.onclick = () => selectOption(idx);
                
                // å¦‚æœå·²ç»å›ç­”è¿‡
                if (answers[q.id] !== undefined) {
                    btn.disabled = true;
                    if (idx === q.correctIndex) {
                        btn.classList.add('correct');
                    } else if (idx === answers[q.id]) {
                        btn.classList.add('wrong');
                    }
                }
                
                optionsGrid.appendChild(btn);
            });
            
            // æ˜¾ç¤º/éšè—è§£é‡Š
            const explanationArea = document.getElementById('explanationArea');
            const leakWarning = document.getElementById('leakWarning');
            
            if (answers[q.id] !== undefined) {
                explanationArea.classList.add('show');
                document.getElementById('explanationText').textContent = q.explanation;
                
                // å¦‚æœç­”é”™äº†ï¼Œæ˜¾ç¤ºæ¼æ´
                if (answers[q.id] !== q.correctIndex) {
                    leakWarning.classList.remove('hidden');
                    document.getElementById('leakDesc').textContent = q.leakDesc;
                } else {
                    leakWarning.classList.add('hidden');
                }
            } else {
                explanationArea.classList.remove('show');
            }
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            updateNavButtons();
            renderCategoryIndicator();
        }
        
        // é€‰æ‹©ç­”æ¡ˆ
        function selectOption(idx) {
            const q = allQuestions[currentQuestionIndex];
            
            // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œä¸å¤„ç†
            if (answers[q.id] !== undefined) return;
            
            answers[q.id] = idx;
            
            // æ›´æ–°ç»Ÿè®¡
            if (idx === q.correctIndex) {
                categoryStats[q.categoryKey].correct++;
            } else {
                // è®°å½•æ¼æ´
                leaksDetected.push({
                    tag: q.leakTag,
                    desc: q.leakDesc,
                    category: q.category,
                    question: q.question
                });
            }
            
            // é‡æ–°æ¸²æŸ“
            renderQuestion();
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const answered = Object.keys(answers).length;
            const total = allQuestions.length;
            const correct = Object.values(categoryStats).reduce((sum, cat) => sum + cat.correct, 0);
            
            document.getElementById('progressText').textContent = `${answered} / ${total}`;
            document.getElementById('correctCount').textContent = `æ­£ç¡®: ${correct}`;
            document.getElementById('progressFill').style.width = `${(answered / total) * 100}%`;
        }
        
        // æ›´æ–°å¯¼èˆªæŒ‰é’®
        function updateNavButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            const isLastQuestion = currentQuestionIndex === allQuestions.length - 1;
            const isAnswered = answers[allQuestions[currentQuestionIndex].id] !== undefined;
            
            if (isLastQuestion && isAnswered) {
                nextBtn.textContent = 'ğŸ“Š æŸ¥çœ‹ç»“æœ';
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€é¢˜ â†’';
            }
            
            nextBtn.disabled = !isAnswered;
        }
        
        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }
        
        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestionIndex < allQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                showResults();
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
            
            // è®¡ç®—æ€»åˆ†
            const totalCorrect = Object.values(categoryStats).reduce((sum, cat) => sum + cat.correct, 0);
            const totalQuestions = allQuestions.length;
            const percentage = Math.round((totalCorrect / totalQuestions) * 100);
            
            // è®¾ç½®åˆ†æ•°æ˜¾ç¤º
            const scoreCircle = document.getElementById('scoreCircle');
            document.getElementById('scoreValue').textContent = `${percentage}%`;
            
            // æ ¹æ®åˆ†æ•°è®¾ç½®ç­‰çº§
            let grade, gradeClass;
            if (percentage >= 90) {
                grade = 'ğŸ† ä¸–ç•Œçº§æ°´å‡†';
                gradeClass = 'excellent';
            } else if (percentage >= 75) {
                grade = 'â­ é«˜é˜¶ç©å®¶';
                gradeClass = 'good';
            } else if (percentage >= 60) {
                grade = 'ğŸ“ˆ ä¸­çº§ç©å®¶';
                gradeClass = 'average';
            } else {
                grade = 'ğŸ¯ éœ€è¦æå‡';
                gradeClass = 'poor';
            }
            
            scoreCircle.className = `score-circle ${gradeClass}`;
            document.getElementById('resultGrade').textContent = grade;
            
            // æ¸²æŸ“å„ç±»åˆ«åˆ†æ•°
            renderCategoryScores();
            
            // æ¸²æŸ“æ¼æ´åˆ†æ
            renderLeakAnalysis();
            
            // æ¸²æŸ“å»ºè®®
            renderRecommendations();
        }
        
        // æ¸²æŸ“ç±»åˆ«åˆ†æ•°
        function renderCategoryScores() {
            const container = document.getElementById('categoryScores');
            container.innerHTML = '';
            
            for (const [key, stats] of Object.entries(categoryStats)) {
                const config = CATEGORY_CONFIG[key];
                const percent = Math.round((stats.correct / stats.total) * 100);
                
                let fillColor;
                if (percent >= 80) fillColor = 'var(--accent-green)';
                else if (percent >= 60) fillColor = 'var(--accent-gold)';
                else fillColor = 'var(--accent-red)';
                
                const row = document.createElement('div');
                row.className = 'category-score-row';
                row.innerHTML = `
                    <div class="category-name">
                        <span class="category-icon">${config.icon}</span>
                        <span>${config.name}</span>
                    </div>
                    <div class="category-bar">
                        <div class="category-fill" style="width: ${percent}%; background: ${fillColor}"></div>
                    </div>
                    <span class="category-percent" style="color: ${fillColor}">${percent}%</span>
                `;
                container.appendChild(row);
            }
        }
        
        // æ¸²æŸ“æ¼æ´åˆ†æ
        function renderLeakAnalysis() {
            const container = document.getElementById('leakGroups');
            container.innerHTML = '';
            
            if (leaksDetected.length === 0) {
                container.innerHTML = '<p style="color: var(--accent-green); text-align: center;">ğŸ‰ æ­å–œï¼æœªæ£€æµ‹åˆ°æ˜æ˜¾æ¼æ´ï¼</p>';
                return;
            }
            
            // æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç»„
            const grouped = {
                'ä¸¥é‡': [],
                'é«˜': [],
                'ä¸­': []
            };
            
            leaksDetected.forEach(leak => {
                const severity = LEAK_SEVERITY[leak.tag]?.severity || 'ä¸­';
                grouped[severity].push(leak);
            });
            
            // æ¸²æŸ“æ¯ä¸ªç»„
            for (const [severity, leaks] of Object.entries(grouped)) {
                if (leaks.length === 0) continue;
                
                const severityClass = severity === 'ä¸¥é‡' ? 'severe' : (severity === 'é«˜' ? 'high' : 'medium');
                
                const group = document.createElement('div');
                group.className = `leak-group ${severityClass}`;
                
                group.innerHTML = `
                    <h4>${severity === 'ä¸¥é‡' ? 'ğŸš¨' : (severity === 'é«˜' ? 'âš ï¸' : 'ğŸ“')} ${severity}æ¼æ´ (${leaks.length}ä¸ª)</h4>
                `;
                
                leaks.forEach(leak => {
                    const item = document.createElement('div');
                    item.className = 'leak-item';
                    item.innerHTML = `
                        <span class="leak-name">${leak.desc}</span>
                        <button class="train-btn" onclick="trainLeak('${leak.tag}')">è®­ç»ƒ</button>
                    `;
                    group.appendChild(item);
                });
                
                container.appendChild(group);
            }
        }
        
        // æ¸²æŸ“å»ºè®®
        function renderRecommendations() {
            const container = document.getElementById('recList');
            container.innerHTML = '';
            
            // æ‰¾å‡ºæœ€å¼±çš„ç±»åˆ«
            const sortedCategories = Object.entries(categoryStats)
                .map(([key, stats]) => ({
                    key,
                    name: CATEGORY_CONFIG[key].name,
                    percent: (stats.correct / stats.total) * 100
                }))
                .sort((a, b) => a.percent - b.percent);
            
            // ç”Ÿæˆå»ºè®®
            const recs = [];
            
            // æœ€å¼±çš„3ä¸ªç»´åº¦
            sortedCategories.slice(0, 3).forEach((cat, idx) => {
                if (cat.percent < 80) {
                    recs.push({
                        priority: idx === 0 ? 'ä¼˜å…ˆçº§1' : (idx === 1 ? 'ä¼˜å…ˆçº§2' : 'ä¼˜å…ˆçº§3'),
                        text: `åŠ å¼ºã€${cat.name}ã€‘è®­ç»ƒï¼Œå½“å‰æ­£ç¡®ç‡${Math.round(cat.percent)}%`
                    });
                }
            });
            
            // ä¸¥é‡æ¼æ´å»ºè®®
            const severeLeaks = leaksDetected.filter(l => LEAK_SEVERITY[l.tag]?.severity === 'ä¸¥é‡');
            if (severeLeaks.length > 0) {
                recs.unshift({
                    priority: 'ç´§æ€¥',
                    text: `å‘ç°${severeLeaks.length}ä¸ªä¸¥é‡æ¼æ´ï¼Œå¿…é¡»ç«‹å³ä¿®å¤ï¼`
                });
            }
            
            // å¦‚æœè¡¨ç°å¾ˆå¥½
            if (recs.length === 0) {
                recs.push({
                    priority: 'ä¿æŒ',
                    text: 'ä½ çš„è¡¨ç°éå¸¸å‡ºè‰²ï¼ä¿æŒå­¦ä¹ å’Œå¤ä¹ ï¼ŒæŒç»­æå‡ã€‚'
                });
            }
            
            // æ¸²æŸ“
            recs.forEach(rec => {
                const item = document.createElement('div');
                item.className = 'rec-item';
                item.innerHTML = `
                    <div class="priority">${rec.priority}</div>
                    <div>${rec.text}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // è®­ç»ƒç‰¹å®šæ¼æ´
        function trainLeak(leakTag) {
            const info = LEAK_SEVERITY[leakTag];
            if (info) {
                const trainerUrl = `advanced_trainer.html?module=${info.training}`;
                window.open(trainerUrl, '_blank');
            }
        }
        
        // é‡æ–°å¼€å§‹
        function restartAssessment() {
            document.getElementById('welcomeScreen').classList.remove('hidden');
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const totalCorrect = Object.values(categoryStats).reduce((sum, cat) => sum + cat.correct, 0);
            const percentage = Math.round((totalCorrect / allQuestions.length) * 100);
            
            let report = `====== å¾·å·æ‰‘å…‹æ¼æ´è¯Šæ–­æŠ¥å‘Š ======\n`;
            report += `è¯„ä¼°æ—¥æœŸ: ${new Date().toLocaleString()}\n`;
            report += `æ€»åˆ†: ${percentage}%\n\n`;
            
            report += `=== å„ç»´åº¦æˆç»© ===\n`;
            for (const [key, stats] of Object.entries(categoryStats)) {
                const config = CATEGORY_CONFIG[key];
                const percent = Math.round((stats.correct / stats.total) * 100);
                report += `${config.name}: ${stats.correct}/${stats.total} (${percent}%)\n`;
            }
            
            report += `\n=== æ£€æµ‹åˆ°çš„æ¼æ´ ===\n`;
            if (leaksDetected.length === 0) {
                report += `æœªæ£€æµ‹åˆ°æ˜æ˜¾æ¼æ´\n`;
            } else {
                leaksDetected.forEach(leak => {
                    const severity = LEAK_SEVERITY[leak.tag]?.severity || 'ä¸­';
                    report += `[${severity}] ${leak.desc}\n`;
                });
            }
            
            // ä¸‹è½½
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `poker_assessment_${new Date().toISOString().slice(0,10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // è·³è½¬åˆ°è®­ç»ƒ
        function goToTraining() {
            window.location.href = 'advanced_trainer.html';
        }
    </script>
</body>
</html>

